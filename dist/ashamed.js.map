{"version":3,"sources":["ashamed.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","$","AshamedClient","window","q","Path","extend","EventEmitter","diff","applyChanges","applyDiff","strToPath","pathToStr","getPath","WebSocketClient","WebSocket","w3cwebsocket","store","backup","pending","vfn","CHANNEL","DEF_OPTS","host","base","realtime","handleMessage","msg","JSON","parse","data","channel","type","modelUpdate","modelResponse","path","args","changes","patch","cid","err","cb","options","_options","_host","_base","_realtime","_url","ws","http","_err","connect","callback","Math","random","_ready","then","send","stringify","def","defer","onerror","emit","reject","onopen","resolve","onmessage","onclose","promise","_send","op","undefined","item","old","jiff","Array","isArray","replace","split","filter","res","join","startsWith","concat","b","create","src","val","root","folder","shift","Object","keys","target","source","d","forEach","p","patchInPlace","applyChange","change","_events","_maxListeners","prototype","defaultMaxListeners","setMaxListeners","isNumber","isNaN","TypeError","er","handler","len","listeners","error","isObject","arguments","context","isUndefined","isFunction","slice","apply","addListener","listener","m","newListener","push","warned","console","trace","on","once","fired","g","removeListener","list","position","splice","removeAllListeners","key","ret","listenerCount","evlistener","emitter","arg","hasOwn","hasOwnProperty","toStr","toString","arr","isPlainObject","obj","hasOwnConstructor","hasIsPrototypeOf","constructor","name","copy","copyIsArray","clone","deep","lcs","array","inverse","jsonPointer","encodeSegment","applyInPlace","InvalidPatchOperationError","TestFailedError","PatchNotInvertibleError","isValidObject","defaultHash","appendChanges","initState","hash","orElse","makeContext","defaultContext","invertible","state","appendArrayChanges","appendObjectChanges","appendValueChanges","o1","o2","keyPath","value","a1","a2","a1hash","map","a2hash","lcsMatrix","compare","lcsToJsonPatch","offset","reduce","j","last","REMOVE","ADD","predicate","x","y","message","captureStackTrace","cons","tail","cloneArray","cloneObject","k","commutePaths","left","right","prefix","getCommonPathPrefix","isArrayPath","ac","copyPatch","bc","commuteArrayPaths","commuteTreePaths","commuteArraySiblings","commuteArrayAncestor","absolute","index","isValidArrayIndex","lpath","rpath","lindex","rindex","commuted","max","direction","rc","p1","p2","p1l","p2l","min","from","deepEquals","compareArrays","compareObjects","akeys","bkeys","patches","pr","skip","invertOp","c","defaultOptions","_parse","find","contains","decodeSegment","parseArrayIndex","separator","separatorRx","encodedSeparator","encodedSeparatorRx","escapeChar","escapeRx","encodedEscape","encodedEscapeRx","findContext","parent","hasContext","segment","findIndex","segments","bind","indexOf","arrayIndexRx","test","SyntaxError","start","jsonPointerParse","parseRx","onSegment","pos","accum","matches","match","charAt","lastIndex","exec","RIGHT","DOWN","SKIP","EQUAL","cols","rows","findPrefix","suffix","findSuffix","remove","matrix","createMatrix","backtrack","al","bl","lastrow","applyTest","invertTest","commute","commuteTest","add","applyAdd","invertAdd","commuteAddOrCopy","applyRemove","invertRemove","commuteRemove","applyReplace","invertReplace","commuteReplace","move","applyMove","invertMove","commuteMove","applyCopy","notInvertible","pointer","notFound","_add","before","after","missingValue","prev","_remove","removed","pto","pfrom","fromContext","_","process","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","setTimeout","clearTimeout","runTimeout","fun","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","nextTick","Item","title","browser","env","argv","version","versions","noop","off","prependListener","prependOnceListener","binding","cwd","chdir","dir","umask","definition","bootstrap","define","amd","ses","ok","makeQ","self","global","previousQ","Q","noConflict","hasStacks","stack","qStartingLine","captureLine","qFileName","head","task","next","flushing","requestTick","isNodeJS","laterQueue","flush","domain","enter","runSingle","pop","exit","setImmediate","MessageChannel","port1","requestPortTick","port2","postMessage","runAfter","Function","uncurryThis","array_slice","array_reduce","basis","array_indexOf","array_map","thisp","collect","object_create","Type","object_defineProperty","defineProperty","prop","descriptor","object_hasOwnProperty","object_keys","object","object_toString","isStopIteration","exception","QReturnValue","ReturnValue","STACK_JUMP_SEPARATOR","makeStackTraceLong","stacks","__minimumStackCounter__","stackCounter","configurable","unshift","concatedStacks","filterStackString","stackString","lines","desiredLines","line","isInternalFrame","isNodeFrame","stackLine","getFileNameAndLineNumber","attempt1","Number","attempt2","attempt3","fileNameAndLineNumber","fileName","lineNumber","qEndingLine","firstLine","deprecate","alternative","warn","Promise","isPromiseAlike","coerce","fulfill","longStackSupport","longStackCounter","Q_DEBUG","messages","progressListeners","resolvedPromise","deferred","promiseDispatch","operands","valueOf","nearerValue","nearer","isPromise","inspect","substring","become","newPromise","reason","notify","progress","progressListener","makeNodeResolver","resolver","race","all","passByCopy","that","spread","answerPs","makePromise","fallback","result","inspected","fulfilled","rejected","progressed","done","_fulfilled","_rejected","newException","_progressed","newValue","threw","tap","fcall","thenResolve","when","thenReject","isPending","isFulfilled","isRejected","unhandledReasons","unhandledRejections","reportedUnhandledRejections","trackUnhandledRejections","resetUnhandledRejections","trackRejection","untrackRejection","at","atReport","getUnhandledReasons","stopUnhandledRejectionTracking","rejection","rhs","master","dispatch","async","makeGenerator","continuer","verb","StopIteration","generator","errback","spawn","_return","promised","get","set","del","mapply","post","mcall","invoke","fapply","fbind","fbound","promises","pendingCount","snapshot","any","current","onFulfilled","onRejected","onProgress","allResolved","allSettled","regardless","fail","fin","onUnhandledError","ms","timeoutId","delay","nfapply","nodeArgs","nfcall","nfbind","denodeify","baseArgs","nbind","bound","nmapply","npost","nsend","nmcall","ninvoke","nodeify","nodeback","_global","NativeWebSocket","MozWebSocket","websocket_version","W3CWebSocket","uri","protocols","native_instance"],"mappings":"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","file":"ashamed.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\n(function($) {\n\tvar AshamedClient = require(\"../lib/client.js\");\n\t$.AshamedClient = AshamedClient;\n})(window);\n\n},{\"../lib/client.js\":2}],2:[function(require,module,exports){\nconst\n\tq = require(\"q\"),\n\tPath = require(\"./path.js\"),\n\textend = require(\"extend\"),\n\tEventEmitter = require('events'),\n\tdiff = Path.diff,\n\tapplyChanges = Path.applyChanges,\n\tapplyDiff = Path.applyDiff,\n\tstrToPath = Path.strToPath,\n\tpathToStr = Path.pathToStr,\n\tgetPath = Path.getPath;\n\nconst\tWebSocketClient = typeof(WebSocket)!==\"undefined\"?\n\tWebSocket : require('websocket').w3cwebsocket;\n\nvar store = {}, backup = {};\nvar pending = {};\n\nconst vfn = ()=>{};\nconst CHANNEL = \"ashamed\";\nconst DEF_OPTS = {\n\thost : \"localhost:3000\",\n\tbase : \"\",\n\trealtime : true\n}\n\n/**\n * Handles the websocket responses\n * @param msg Websocket message\n */\nfunction handleMessage(msg) {\n\tmsg = JSON.parse(msg.data);\n\t// If channel is incorrect, do nothing\n\tif(msg.channel!=CHANNEL) return;\n\tif(msg.type == \"model-update\") {modelUpdate(msg);}\n\telse if(msg.type == \"response\") {modelResponse(msg);}\n}\n\n/**\n * Updates the subscribed model with external changes\n * @param msg Websocket message data\n */\nfunction modelUpdate(msg) {\n\tvar path = msg.args[0];\n\tvar changes = msg.args[1]||[];\n\t//var bch = JSON.parse(JSON.stringify(changes));\n\tpath = strToPath(path);\n\n\t// Apply all changes\n\tapplyChanges(backup,changes,path);\n\tvar patch = diff(store,backup);\n\tapplyChanges(store,patch);\n}\n\nfunction modelResponse(msg) {\n\tvar cid = msg.cid;\n\tvar [err,data] = msg.args;\n\n\tif(!pending[cid]) return;\n\telse {\n\t\tvar cb = pending[cid];\n\t\tdelete pending[cid];\n\t\tcb(err,data);\n\t}\n}\n\nclass AshamedClient extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\n\t\toptions = extend({},DEF_OPTS,options);\n\t\tthis._options = options;\n\t\tthis._host = options.host;\n\t\tthis._base = options.base;\n\t\tthis._realtime = options.realtime;\n\t\tthis._url = {\n\t\t\tws : \"ws://\"+options.host+options.base+\"/ws\",\n\t\t\thttp : \"http://\"+options.host+options.base\n\t\t}\n\t\tthis._err = null;\n\t\tthis.connect();\n\t}\n\n\t_send(msg,callback) {\n\t\tvar err = this._err;\n\t\tmsg.channel = CHANNEL;\n\t\tcallback = callback || vfn;\n\n\t\t// Correlation ID to the callback\n\t\tmsg.cid = `ws_${Math.random()}`;\n\t\tpending[msg.cid] = callback;\n\n\t\tif(!err) {\n\t\t\tthis._ready.then(ws=>{\n\t\t\t\tws.send(JSON.stringify(msg));\n\t\t\t},err=>{\n\t\t\t\terr.code = \"ERROR\";\n\t\t\t\tcallback(err,null);\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\terr.code = \"ERROR\";\n\t\t\tcallback(err,null);\n\t\t}\n\t}\n\n\tget store() {\n\t\treturn store;\n\t}\n\n\tconnect() {\n\t\tvar def = q.defer();\n\t\tvar ws = new WebSocketClient(this._url.ws);\n\t\tws.onerror = (err)=>{\n\t\t\tthis._err = `Unable to connect to ${this._url.ws}`;\n\t\t\tthis.emit(\"error\",this._err);\n\t\t\tdef.reject(this._err);\n\t\t}\n\t\tws.onopen = ()=>{\n\t\t\tthis._err = null;\n\t\t\tthis.emit(\"ready\",this);\n\t\t\tdef.resolve(ws);\n\t\t}\n\t\tws.onmessage = (msg)=>{\n\t\t\thandleMessage(msg);\n\t\t\tthis.emit(\"message\",msg);\n\t\t}\n\t\tws.onclose = ()=>{\n\t\t\tthis.emit(\"close\");\n\t\t\tthis._err = new Error(\"Connection has been closed\");\n\t\t}\n\t\tthis._ready = def.promise;\n\t}\n\n\tget(path,options) {\n\t\tvar def = q.defer();\n\t\tvar cid = \"ws_\"+Math.random();\n\n\t\toptions = extend({},this._options,options);\n\t\tthis._send({op:\"get\", args:[path,options]},(err,data)=> {\n\t\t\tif(err && err.code) {def.reject(err);}\n\t\t\telse if(options.realtime && data!==null && data!==undefined) {\n\t\t\t\tapplyDiff(store,data,path);\n\t\t\t\tbackup = extend(true,{},store);\n\t\t\t\tdef.resolve(getPath(path,false,store));\n\t\t\t}\n\t\t\telse {def.resolve(data);}\n\t\t});\n\n\t\treturn def.promise;\n\t}\n\n\tset(path,item,options) {\n\t\tvar def = q.defer();\n\t\tvar cid = \"ws_\"+Math.random();\n\n\t\toptions = extend({},this._options,options);\n\t\tthis._send({op:\"set\", args:[path,item,options]},(err,data)=> {\n\t\t\tif(err && err.code) {def.reject(err);}\n\t\t\telse if(options.realtime) {\n\t\t\t\tapplyDiff(store,data,path);\n\t\t\t\tbackup = extend(true,{},store);\n\t\t\t\tdef.resolve(getPath(path,false,store));\n\t\t\t}\n\t\t\telse {def.resolve(data);}\n\t\t});\n\n\t\treturn def.promise;\n\t}\n\n\tupdate(path,item) {\n\t\tvar s = store;\n\t\tvar old = getPath(path,true,backup);\n\t\tvar changes = diff(old,item);\n\t\treturn this.diff(path,changes);\n\t}\n\n\tdiff(path,changes) {\n\t\tvar def = q.defer();\n\t\tvar cid = \"ws_\"+Math.random();\n\n\t\tthis._send({op:\"diff\", args:[path,changes]},(err,data)=> {\n\t\t\tif(err && err.code) {def.reject(err);}\n\t\t\telse {def.resolve(data);}\n\t\t});\n\n\t\treturn def.promise;\n\t}\n\n\tpath(base) {\n\t\tvar def = q.defer();\n\t\tvar cid = \"ws_\"+Math.random();\n\n\t\tthis._send({op:\"path\", args:[base]},(err,data)=> {\n\t\t\tif(err && err.code) {def.reject(err);}\n\t\t\telse {def.resolve(data);}\n\t\t});\n\n\t\treturn def.promise;\n\t}\n}\n\nmodule.exports = AshamedClient;\n\n},{\"./path.js\":3,\"events\":4,\"extend\":5,\"q\":21,\"websocket\":22}],3:[function(require,module,exports){\nconst\n\textend = require(\"extend\"),\n\tjiff = require(\"jiff\");\n\nfunction strToPath(path) {\n\tpath = path ||[];\n\treturn Array.isArray(path)?\n\t\tpath :\n\t\tpath.replace(/ /g,\"\").split(\"/\").filter(s=>s.length);\n}\n\nfunction pathToStr(path) {\n\tpath = path ||[];\n\tvar res = typeof(path)==\"string\"? path : path.join(\"/\");\n\treturn res.startsWith(\"/\") ? res : `/${res}`;\n}\n\nfunction concat(a,b) {\n\ta = strToPath(a);\n\tb = strToPath(b);\n\treturn pathToStr([].concat(a).concat(b));\n}\n\nfunction getPath(path,create,src,val) {\n\tvar root = src || {};\n\tpath = strToPath(path);\n\tif(!path.length) \t{\n\t\treturn extend(src,val);\n\t}\n\twhile(path.length) {\n\t\tlet folder = path.shift();\n\t\tif(!root[folder]) {\n\t\t\tif(create) {root[folder] = {};}\n\t\t\telse {return null;}\n\t\t}\n\t\tif(!path.length && val!==undefined)\t{\n\t\t\tif(typeof(root[folder])==\"object\" && Object.keys(root[folder]).length) {\n\t\t\t\tif(typeof(val)==\"object\") extend(true,root[folder],val);\n\t\t\t\telse root[folder] = val;\n\t\t\t}\n\t\t\telse {\n\t\t\t\troot[folder] = val;\n\t\t\t}\n\t\t}\n\t\troot = root[folder];\n\t\tif(!path.length) return root;\n\t}\n}\n\nfunction diff(target,source) {\n\treturn jiff.diff(target,source).filter(d=>d.op!=\"test\");\n}\n\nfunction applyDiff(target,source,path) {\n\tvar d = {};\n\tgetPath(path,true,d,source);\n\treturn extend(true,target,d);\n}\n\nfunction applyChanges(target,patch,path) {\n\tpatch.forEach(p=>{\n\t\tp.path = concat(path,p.path);\n\t\tgetPath(p.path,false,target);\n\t});\n\tjiff.patchInPlace(patch, target);\n}\n\nfunction applyChange(target,change) {\n\tgetPath(change.path,false,target);\n\tjiff.patchInPlace([change], target);\n}\n\nmodule.exports = {\n\tstrToPath : strToPath,\n\tpathToStr : pathToStr,\n\tgetPath : getPath,\n\tdiff : diff,\n\tconcat : concat,\n\tapplyDiff : applyDiff,\n\tapplyChange : applyChange,\n\tapplyChanges : applyChanges,\n}\n\n},{\"extend\":5,\"jiff\":6}],4:[function(require,module,exports){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n},{}],5:[function(require,module,exports){\n'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) { /**/ }\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone;\n\tvar target = arguments[0];\n\tvar i = 1;\n\tvar length = arguments.length;\n\tvar deep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t}\n\tif (target == null || (typeof target !== 'object' && typeof target !== 'function')) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = target[name];\n\t\t\t\tcopy = options[name];\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\ttarget[name] = extend(deep, clone, copy);\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n\n},{}],6:[function(require,module,exports){\n/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\nvar lcs = require('./lib/lcs');\nvar array = require('./lib/array');\nvar patch = require('./lib/jsonPatch');\nvar inverse = require('./lib/inverse');\nvar jsonPointer = require('./lib/jsonPointer');\nvar encodeSegment = jsonPointer.encodeSegment;\n\nexports.diff = diff;\nexports.patch = patch.apply;\nexports.patchInPlace = patch.applyInPlace;\nexports.inverse = inverse;\nexports.clone = patch.clone;\n\n// Errors\nexports.InvalidPatchOperationError = require('./lib/InvalidPatchOperationError');\nexports.TestFailedError = require('./lib/TestFailedError');\nexports.PatchNotInvertibleError = require('./lib/PatchNotInvertibleError');\n\nvar isValidObject = patch.isValidObject;\nvar defaultHash = patch.defaultHash;\n\n/**\n * Compute a JSON Patch representing the differences between a and b.\n * @param {object|array|string|number|null} a\n * @param {object|array|string|number|null} b\n * @param {?function|?object} options if a function, see options.hash\n * @param {?function(x:*):String|Number} options.hash used to hash array items\n *  in order to recognize identical objects, defaults to JSON.stringify\n * @param {?function(index:Number, array:Array):object} options.makeContext\n *  used to generate patch context. If not provided, context will not be generated\n * @returns {array} JSON Patch such that patch(diff(a, b), a) ~ b\n */\nfunction diff(a, b, options) {\n\treturn appendChanges(a, b, '', initState(options, [])).patch;\n}\n\n/**\n * Create initial diff state from the provided options\n * @param {?function|?object} options @see diff options above\n * @param {array} patch an empty or existing JSON Patch array into which\n *  the diff should generate new patch operations\n * @returns {object} initialized diff state\n */\nfunction initState(options, patch) {\n\tif(typeof options === 'object') {\n\t\treturn {\n\t\t\tpatch: patch,\n\t\t\thash: orElse(isFunction, options.hash, defaultHash),\n\t\t\tmakeContext: orElse(isFunction, options.makeContext, defaultContext),\n\t\t\tinvertible: !(options.invertible === false)\n\t\t};\n\t} else {\n\t\treturn {\n\t\t\tpatch: patch,\n\t\t\thash: orElse(isFunction, options, defaultHash),\n\t\t\tmakeContext: defaultContext,\n\t\t\tinvertible: true\n\t\t};\n\t}\n}\n\n/**\n * Given two JSON values (object, array, number, string, etc.), find their\n * differences and append them to the diff state\n * @param {object|array|string|number|null} a\n * @param {object|array|string|number|null} b\n * @param {string} path\n * @param {object} state\n * @returns {Object} updated diff state\n */\nfunction appendChanges(a, b, path, state) {\n\tif(Array.isArray(a) && Array.isArray(b)) {\n\t\treturn appendArrayChanges(a, b, path, state);\n\t}\n\n\tif(isValidObject(a) && isValidObject(b)) {\n\t\treturn appendObjectChanges(a, b, path, state);\n\t}\n\n\treturn appendValueChanges(a, b, path, state);\n}\n\n/**\n * Given two objects, find their differences and append them to the diff state\n * @param {object} o1\n * @param {object} o2\n * @param {string} path\n * @param {object} state\n * @returns {Object} updated diff state\n */\nfunction appendObjectChanges(o1, o2, path, state) {\n\tvar keys = Object.keys(o2);\n\tvar patch = state.patch;\n\tvar i, key;\n\n\tfor(i=keys.length-1; i>=0; --i) {\n\t\tkey = keys[i];\n\t\tvar keyPath = path + '/' + encodeSegment(key);\n\t\tif(o1[key] !== void 0) {\n\t\t\tappendChanges(o1[key], o2[key], keyPath, state);\n\t\t} else {\n\t\t\tpatch.push({ op: 'add', path: keyPath, value: o2[key] });\n\t\t}\n\t}\n\n\tkeys = Object.keys(o1);\n\tfor(i=keys.length-1; i>=0; --i) {\n\t\tkey = keys[i];\n\t\tif(o2[key] === void 0) {\n\t\t\tvar p = path + '/' + encodeSegment(key);\n\t\t\tif(state.invertible) {\n\t\t\t\tpatch.push({ op: 'test', path: p, value: o1[key] });\n\t\t\t}\n\t\t\tpatch.push({ op: 'remove', path: p });\n\t\t}\n\t}\n\n\treturn state;\n}\n\n/**\n * Given two arrays, find their differences and append them to the diff state\n * @param {array} a1\n * @param {array} a2\n * @param {string} path\n * @param {object} state\n * @returns {Object} updated diff state\n */\nfunction appendArrayChanges(a1, a2, path, state) {\n\tvar a1hash = array.map(state.hash, a1);\n\tvar a2hash = array.map(state.hash, a2);\n\n\tvar lcsMatrix = lcs.compare(a1hash, a2hash);\n\n\treturn lcsToJsonPatch(a1, a2, path, state, lcsMatrix);\n}\n\n/**\n * Transform an lcsMatrix into JSON Patch operations and append\n * them to state.patch, recursing into array elements as necessary\n * @param {array} a1\n * @param {array} a2\n * @param {string} path\n * @param {object} state\n * @param {object} lcsMatrix\n * @returns {object} new state with JSON Patch operations added based\n *  on the provided lcsMatrix\n */\nfunction lcsToJsonPatch(a1, a2, path, state, lcsMatrix) {\n\tvar offset = 0;\n\treturn lcs.reduce(function(state, op, i, j) {\n\t\tvar last, context;\n\t\tvar patch = state.patch;\n\t\tvar p = path + '/' + (j + offset);\n\n\t\tif (op === lcs.REMOVE) {\n\t\t\t// Coalesce adjacent remove + add into replace\n\t\t\tlast = patch[patch.length-1];\n\t\t\tcontext = state.makeContext(j, a1);\n\n\t\t\tif(state.invertible) {\n\t\t\t\tpatch.push({ op: 'test', path: p, value: a1[j], context: context });\n\t\t\t}\n\n\t\t\tif(last !== void 0 && last.op === 'add' && last.path === p) {\n\t\t\t\tlast.op = 'replace';\n\t\t\t\tlast.context = context;\n\t\t\t} else {\n\t\t\t\tpatch.push({ op: 'remove', path: p, context: context });\n\t\t\t}\n\n\t\t\toffset -= 1;\n\n\t\t} else if (op === lcs.ADD) {\n\t\t\t// See https://tools.ietf.org/html/rfc6902#section-4.1\n\t\t\t// May use either index===length *or* '-' to indicate appending to array\n\t\t\tpatch.push({ op: 'add', path: p, value: a2[i],\n\t\t\t\tcontext: state.makeContext(j, a1)\n\t\t\t});\n\n\t\t\toffset += 1;\n\n\t\t} else {\n\t\t\tappendChanges(a1[j], a2[i], p, state);\n\t\t}\n\n\t\treturn state;\n\n\t}, state, lcsMatrix);\n}\n\n/**\n * Given two number|string|null values, if they differ, append to diff state\n * @param {string|number|null} a\n * @param {string|number|null} b\n * @param {string} path\n * @param {object} state\n * @returns {object} updated diff state\n */\nfunction appendValueChanges(a, b, path, state) {\n\tif(a !== b) {\n\t\tif(state.invertible) {\n\t\t\tstate.patch.push({ op: 'test', path: path, value: a });\n\t\t}\n\n\t\tstate.patch.push({ op: 'replace', path: path, value: b });\n\t}\n\n\treturn state;\n}\n\n/**\n * @param {function} predicate\n * @param {*} x\n * @param {*} y\n * @returns {*} x if predicate(x) is truthy, otherwise y\n */\nfunction orElse(predicate, x, y) {\n\treturn predicate(x) ? x : y;\n}\n\n/**\n * Default patch context generator\n * @returns {undefined} undefined context\n */\nfunction defaultContext() {\n\treturn void 0;\n}\n\n/**\n * @param {*} x\n * @returns {boolean} true if x is a function, false otherwise\n */\nfunction isFunction(x) {\n\treturn typeof x === 'function';\n}\n\n},{\"./lib/InvalidPatchOperationError\":7,\"./lib/PatchNotInvertibleError\":8,\"./lib/TestFailedError\":9,\"./lib/array\":10,\"./lib/inverse\":14,\"./lib/jsonPatch\":15,\"./lib/jsonPointer\":16,\"./lib/lcs\":18}],7:[function(require,module,exports){\nmodule.exports = InvalidPatchOperationError;\n\nfunction InvalidPatchOperationError(message) {\n\tError.call(this);\n\tthis.name = this.constructor.name;\n\tthis.message = message;\n\tif(typeof Error.captureStackTrace === 'function') {\n\t\tError.captureStackTrace(this, this.constructor);\n\t}\n}\n\nInvalidPatchOperationError.prototype = Object.create(Error.prototype);\nInvalidPatchOperationError.prototype.constructor = InvalidPatchOperationError;\n},{}],8:[function(require,module,exports){\nmodule.exports = PatchNotInvertibleError;\n\nfunction PatchNotInvertibleError(message) {\n\tError.call(this);\n\tthis.name = this.constructor.name;\n\tthis.message = message;\n\tif(typeof Error.captureStackTrace === 'function') {\n\t\tError.captureStackTrace(this, this.constructor);\n\t}\n}\n\nPatchNotInvertibleError.prototype = Object.create(Error.prototype);\nPatchNotInvertibleError.prototype.constructor = PatchNotInvertibleError;\n},{}],9:[function(require,module,exports){\nmodule.exports = TestFailedError;\n\nfunction TestFailedError(message) {\n\tError.call(this);\n\tthis.name = this.constructor.name;\n\tthis.message = message;\n\tif(typeof Error.captureStackTrace === 'function') {\n\t\tError.captureStackTrace(this, this.constructor);\n\t}\n}\n\nTestFailedError.prototype = Object.create(Error.prototype);\nTestFailedError.prototype.constructor = TestFailedError;\n},{}],10:[function(require,module,exports){\n/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\nexports.cons = cons;\nexports.tail = tail;\nexports.map = map;\n\n/**\n * Prepend x to a, without mutating a. Faster than a.unshift(x)\n * @param {*} x\n * @param {Array} a array-like\n * @returns {Array} new Array with x prepended\n */\nfunction cons(x, a) {\n\tvar l = a.length;\n\tvar b = new Array(l+1);\n\tb[0] = x;\n\tfor(var i=0; i<l; ++i) {\n\t\tb[i+1] = a[i];\n\t}\n\n\treturn b;\n}\n\n/**\n * Create a new Array containing all elements in a, except the first.\n *  Faster than a.slice(1)\n * @param {Array} a array-like\n * @returns {Array} new Array, the equivalent of a.slice(1)\n */\nfunction tail(a) {\n\tvar l = a.length-1;\n\tvar b = new Array(l);\n\tfor(var i=0; i<l; ++i) {\n\t\tb[i] = a[i+1];\n\t}\n\n\treturn b;\n}\n\n/**\n * Map any array-like. Faster than Array.prototype.map\n * @param {function} f\n * @param {Array} a array-like\n * @returns {Array} new Array mapped by f\n */\nfunction map(f, a) {\n\tvar b = new Array(a.length);\n\tfor(var i=0; i< a.length; ++i) {\n\t\tb[i] = f(a[i]);\n\t}\n\treturn b;\n}\n},{}],11:[function(require,module,exports){\n/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n/**\n * Create a deep copy of x which must be a legal JSON object/array/value\n * @param {object|array|string|number|null} x object/array/value to clone\n * @returns {object|array|string|number|null} clone of x\n */\nmodule.exports = clone;\n\nfunction clone(x) {\n\tif(x == null || typeof x !== 'object') {\n\t\treturn x;\n\t}\n\n\tif(Array.isArray(x)) {\n\t\treturn cloneArray(x);\n\t}\n\n\treturn cloneObject(x);\n}\n\nfunction cloneArray (x) {\n\tvar l = x.length;\n\tvar y = new Array(l);\n\n\tfor (var i = 0; i < l; ++i) {\n\t\ty[i] = clone(x[i]);\n\t}\n\n\treturn y;\n}\n\nfunction cloneObject (x) {\n\tvar keys = Object.keys(x);\n\tvar y = {};\n\n\tfor (var k, i = 0, l = keys.length; i < l; ++i) {\n\t\tk = keys[i];\n\t\ty[k] = clone(x[k]);\n\t}\n\n\treturn y;\n}\n\n},{}],12:[function(require,module,exports){\nvar jsonPointer = require('./jsonPointer');\n\n/**\n * commute the patch sequence a,b to b,a\n * @param {object} a patch operation\n * @param {object} b patch operation\n */\nmodule.exports = function commutePaths(a, b) {\n\t// TODO: cases for special paths: '' and '/'\n\tvar left = jsonPointer.parse(a.path);\n\tvar right = jsonPointer.parse(b.path);\n\tvar prefix = getCommonPathPrefix(left, right);\n\tvar isArray = isArrayPath(left, right, prefix.length);\n\n\t// Never mutate the originals\n\tvar ac = copyPatch(a);\n\tvar bc = copyPatch(b);\n\n\tif(prefix.length === 0 && !isArray) {\n\t\t// Paths share no common ancestor, simple swap\n\t\treturn [bc, ac];\n\t}\n\n\tif(isArray) {\n\t\treturn commuteArrayPaths(ac, left, bc, right);\n\t} else {\n\t\treturn commuteTreePaths(ac, left, bc, right);\n\t}\n};\n\nfunction commuteTreePaths(a, left, b, right) {\n\tif(a.path === b.path) {\n\t\tthrow new TypeError('cannot commute ' + a.op + ',' + b.op + ' with identical object paths');\n\t}\n\t// FIXME: Implement tree path commutation\n\treturn [b, a];\n}\n\n/**\n * Commute two patches whose common ancestor (which may be the immediate parent)\n * is an array\n * @param a\n * @param left\n * @param b\n * @param right\n * @returns {*}\n */\nfunction commuteArrayPaths(a, left, b, right) {\n\tif(left.length === right.length) {\n\t\treturn commuteArraySiblings(a, left, b, right);\n\t}\n\n\tif (left.length > right.length) {\n\t\t// left is longer, commute by \"moving\" it to the right\n\t\tleft = commuteArrayAncestor(b, right, a, left, -1);\n\t\ta.path = jsonPointer.absolute(jsonPointer.join(left));\n\t} else {\n\t\t// right is longer, commute by \"moving\" it to the left\n\t\tright = commuteArrayAncestor(a, left, b, right, 1);\n\t\tb.path = jsonPointer.absolute(jsonPointer.join(right));\n\t}\n\n\treturn [b, a];\n}\n\nfunction isArrayPath(left, right, index) {\n\treturn jsonPointer.isValidArrayIndex(left[index])\n\t\t&& jsonPointer.isValidArrayIndex(right[index]);\n}\n\n/**\n * Commute two patches referring to items in the same array\n * @param l\n * @param lpath\n * @param r\n * @param rpath\n * @returns {*[]}\n */\nfunction commuteArraySiblings(l, lpath, r, rpath) {\n\n\tvar target = lpath.length-1;\n\tvar lindex = +lpath[target];\n\tvar rindex = +rpath[target];\n\n\tvar commuted;\n\n\tif(lindex < rindex) {\n\t\t// Adjust right path\n\t\tif(l.op === 'add' || l.op === 'copy') {\n\t\t\tcommuted = rpath.slice();\n\t\t\tcommuted[target] = Math.max(0, rindex - 1);\n\t\t\tr.path = jsonPointer.absolute(jsonPointer.join(commuted));\n\t\t} else if(l.op === 'remove') {\n\t\t\tcommuted = rpath.slice();\n\t\t\tcommuted[target] = rindex + 1;\n\t\t\tr.path = jsonPointer.absolute(jsonPointer.join(commuted));\n\t\t}\n\t} else if(r.op === 'add' || r.op === 'copy') {\n\t\t// Adjust left path\n\t\tcommuted = lpath.slice();\n\t\tcommuted[target] = lindex + 1;\n\t\tl.path = jsonPointer.absolute(jsonPointer.join(commuted));\n\t} else if (lindex > rindex && r.op === 'remove') {\n\t\t// Adjust left path only if remove was at a (strictly) lower index\n\t\tcommuted = lpath.slice();\n\t\tcommuted[target] = Math.max(0, lindex - 1);\n\t\tl.path = jsonPointer.absolute(jsonPointer.join(commuted));\n\t}\n\n\treturn [r, l];\n}\n\n/**\n * Commute two patches with a common array ancestor\n * @param l\n * @param lpath\n * @param r\n * @param rpath\n * @param direction\n * @returns {*}\n */\nfunction commuteArrayAncestor(l, lpath, r, rpath, direction) {\n\t// rpath is longer or same length\n\n\tvar target = lpath.length-1;\n\tvar lindex = +lpath[target];\n\tvar rindex = +rpath[target];\n\n\t// Copy rpath, then adjust its array index\n\tvar rc = rpath.slice();\n\n\tif(lindex > rindex) {\n\t\treturn rc;\n\t}\n\n\tif(l.op === 'add' || l.op === 'copy') {\n\t\trc[target] = Math.max(0, rindex - direction);\n\t} else if(l.op === 'remove') {\n\t\trc[target] = Math.max(0, rindex + direction);\n\t}\n\n\treturn rc;\n}\n\nfunction getCommonPathPrefix(p1, p2) {\n\tvar p1l = p1.length;\n\tvar p2l = p2.length;\n\tif(p1l === 0 || p2l === 0 || (p1l < 2 && p2l < 2)) {\n\t\treturn [];\n\t}\n\n\t// If paths are same length, the last segment cannot be part\n\t// of a common prefix.  If not the same length, the prefix cannot\n\t// be longer than the shorter path.\n\tvar l = p1l === p2l\n\t\t? p1l - 1\n\t\t: Math.min(p1l, p2l);\n\n\tvar i = 0;\n\twhile(i < l && p1[i] === p2[i]) {\n\t\t++i\n\t}\n\n\treturn p1.slice(0, i);\n}\n\nfunction copyPatch(p) {\n\tif(p.op === 'remove') {\n\t\treturn { op: p.op, path: p.path };\n\t}\n\n\tif(p.op === 'copy' || p.op === 'move') {\n\t\treturn { op: p.op, path: p.path, from: p.from };\n\t}\n\n\t// test, add, replace\n\treturn { op: p.op, path: p.path, value: p.value };\n}\n},{\"./jsonPointer\":16}],13:[function(require,module,exports){\nmodule.exports = deepEquals;\n\n/**\n * Compare 2 JSON values, or recursively compare 2 JSON objects or arrays\n * @param {object|array|string|number|boolean|null} a\n * @param {object|array|string|number|boolean|null} b\n * @returns {boolean} true iff a and b are recursively equal\n */\nfunction deepEquals(a, b) {\n\tif(a === b) {\n\t\treturn true;\n\t}\n\n\tif(Array.isArray(a) && Array.isArray(b)) {\n\t\treturn compareArrays(a, b);\n\t}\n\n\tif(typeof a === 'object' && typeof b === 'object') {\n\t\treturn compareObjects(a, b);\n\t}\n\n\treturn false;\n}\n\nfunction compareArrays(a, b) {\n\tif(a.length !== b.length) {\n\t\treturn false;\n\t}\n\n\tfor(var i = 0; i<a.length; ++i) {\n\t\tif(!deepEquals(a[i], b[i])) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction compareObjects(a, b) {\n\tif((a === null && b !== null) || (a !== null && b === null)) {\n\t\treturn false;\n\t}\n\n\tvar akeys = Object.keys(a);\n\tvar bkeys = Object.keys(b);\n\n\tif(akeys.length !== bkeys.length) {\n\t\treturn false;\n\t}\n\n\tfor(var i = 0, k; i<akeys.length; ++i) {\n\t\tk = akeys[i];\n\t\tif(!(k in b && deepEquals(a[k], b[k]))) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n},{}],14:[function(require,module,exports){\nvar patches = require('./patches');\n\nmodule.exports = function inverse(p) {\n\tvar pr = [];\n\tvar i, skip;\n\tfor(i = p.length-1; i>= 0; i -= skip) {\n\t\tskip = invertOp(pr, p[i], i, p);\n\t}\n\n\treturn pr;\n};\n\nfunction invertOp(patch, c, i, context) {\n\tvar op = patches[c.op];\n\treturn op !== void 0 && typeof op.inverse === 'function'\n\t\t? op.inverse(patch, c, i, context)\n\t\t: 1;\n}\n\n},{\"./patches\":19}],15:[function(require,module,exports){\n/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\nvar patches = require('./patches');\nvar clone = require('./clone');\nvar InvalidPatchOperationError = require('./InvalidPatchOperationError');\n\nexports.apply = patch;\nexports.applyInPlace = patchInPlace;\nexports.clone = clone;\nexports.isValidObject = isValidObject;\nexports.defaultHash = defaultHash;\n\nvar defaultOptions = {};\n\n/**\n * Apply the supplied JSON Patch to x\n * @param {array} changes JSON Patch\n * @param {object|array|string|number} x object/array/value to patch\n * @param {object} options\n * @param {function(index:Number, array:Array, context:object):Number} options.findContext\n *  function used adjust array indexes for smarty/fuzzy patching, for\n *  patches containing context\n * @returns {object|array|string|number} patched version of x. If x is\n *  an array or object, it will be mutated and returned. Otherwise, if\n *  x is a value, the new value will be returned.\n */\nfunction patch(changes, x, options) {\n\treturn patchInPlace(changes, clone(x), options);\n}\n\nfunction patchInPlace(changes, x, options) {\n\tif(!options) {\n\t\toptions = defaultOptions;\n\t}\n\n\t// TODO: Consider throwing if changes is not an array\n\tif(!Array.isArray(changes)) {\n\t\treturn x;\n\t}\n\n\tvar patch, p;\n\tfor(var i=0; i<changes.length; ++i) {\n\t\tp = changes[i];\n\t\tpatch = patches[p.op];\n\n\t\tif(patch === void 0) {\n\t\t\tthrow new InvalidPatchOperationError('invalid op ' + JSON.stringify(p));\n\t\t}\n\n\t\tx = patch.apply(x, p, options);\n\t}\n\n\treturn x;\n}\n\nfunction defaultHash(x) {\n\treturn isValidObject(x) || isArray(x) ? JSON.stringify(x) : x;\n}\n\nfunction isValidObject (x) {\n\treturn x !== null && Object.prototype.toString.call(x) === '[object Object]';\n}\n\nfunction isArray (x) {\n\treturn Object.prototype.toString.call(x) === '[object Array]';\n}\n\n},{\"./InvalidPatchOperationError\":7,\"./clone\":11,\"./patches\":19}],16:[function(require,module,exports){\n/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\nvar _parse = require('./jsonPointerParse');\n\nexports.find = find;\nexports.join = join;\nexports.absolute = absolute;\nexports.parse = parse;\nexports.contains = contains;\nexports.encodeSegment = encodeSegment;\nexports.decodeSegment = decodeSegment;\nexports.parseArrayIndex = parseArrayIndex;\nexports.isValidArrayIndex = isValidArrayIndex;\n\n// http://tools.ietf.org/html/rfc6901#page-2\nvar separator = '/';\nvar separatorRx = /\\//g;\nvar encodedSeparator = '~1';\nvar encodedSeparatorRx = /~1/g;\n\nvar escapeChar = '~';\nvar escapeRx = /~/g;\nvar encodedEscape = '~0';\nvar encodedEscapeRx = /~0/g;\n\n/**\n * Find the parent of the specified path in x and return a descriptor\n * containing the parent and a key.  If the parent does not exist in x,\n * return undefined, instead.\n * @param {object|array} x object or array in which to search\n * @param {string} path JSON Pointer string (encoded)\n * @param {?function(index:Number, array:Array, context:object):Number} findContext\n *  optional function used adjust array indexes for smarty/fuzzy patching, for\n *  patches containing context.  If provided, context MUST also be provided.\n * @param {?{before:Array, after:Array}} context optional patch context for\n *  findContext to use to adjust array indices.  If provided, findContext MUST\n *  also be provided.\n * @returns {{target:object|array|number|string, key:string}|undefined}\n */\nfunction find(x, path, findContext, context) {\n\tif(typeof path !== 'string') {\n\t\treturn;\n\t}\n\n\tif(path === '') {\n\t\t// whole document\n\t\treturn { target: x, key: void 0 };\n\t}\n\n\tif(path === separator) {\n\t\treturn { target: x, key: '' };\n\t}\n\n\tvar parent = x, key;\n\tvar hasContext = context !== void 0;\n\n\t_parse(path, function(segment) {\n\t\t// hm... this seems like it should be if(typeof x === 'undefined')\n\t\tif(x == null) {\n\t\t\t// Signal that we prematurely hit the end of the path hierarchy.\n\t\t\tparent = null;\n\t\t\treturn false;\n\t\t}\n\n\t\tif(Array.isArray(x)) {\n\t\t\tkey = hasContext\n\t\t\t\t? findIndex(findContext, parseArrayIndex(segment), x, context)\n\t\t\t\t: segment === '-' ? segment : parseArrayIndex(segment);\n\t\t} else {\n\t\t\tkey = segment;\n\t\t}\n\n\t\tparent = x;\n\t\tx = x[key];\n\t});\n\n\treturn parent === null\n\t\t? void 0\n\t\t: { target: parent, key: key };\n}\n\nfunction absolute(path) {\n\treturn path[0] === separator ? path : separator + path;\n}\n\nfunction join(segments) {\n\treturn segments.join(separator);\n}\n\nfunction parse(path) {\n\tvar segments = [];\n\t_parse(path, segments.push.bind(segments));\n\treturn segments;\n}\n\nfunction contains(a, b) {\n\treturn b.indexOf(a) === 0 && b[a.length] === separator;\n}\n\n/**\n * Decode a JSON Pointer path segment\n * @see http://tools.ietf.org/html/rfc6901#page-3\n * @param {string} s encoded segment\n * @returns {string} decoded segment\n */\nfunction decodeSegment(s) {\n\t// See: http://tools.ietf.org/html/rfc6901#page-3\n\treturn s.replace(encodedSeparatorRx, separator).replace(encodedEscapeRx, escapeChar);\n}\n\n/**\n * Encode a JSON Pointer path segment\n * @see http://tools.ietf.org/html/rfc6901#page-3\n * @param {string} s decoded segment\n * @returns {string} encoded segment\n */\nfunction encodeSegment(s) {\n\treturn s.replace(escapeRx, encodedEscape).replace(separatorRx, encodedSeparator);\n}\n\nvar arrayIndexRx = /^(0|[1-9]\\d*)$/;\n\n/**\n * Return true if s is a valid JSON Pointer array index\n * @param {String} s\n * @returns {boolean}\n */\nfunction isValidArrayIndex(s) {\n\treturn arrayIndexRx.test(s);\n}\n\n/**\n * Safely parse a string into a number >= 0. Does not check for decimal numbers\n * @param {string} s numeric string\n * @returns {number} number >= 0\n */\nfunction parseArrayIndex (s) {\n\tif(isValidArrayIndex(s)) {\n\t\treturn +s;\n\t}\n\n\tthrow new SyntaxError('invalid array index ' + s);\n}\n\nfunction findIndex (findContext, start, array, context) {\n\tvar index = start;\n\n\tif(index < 0) {\n\t\tthrow new Error('array index out of bounds ' + index);\n\t}\n\n\tif(context !== void 0 && typeof findContext === 'function') {\n\t\tindex = findContext(start, array, context);\n\t\tif(index < 0) {\n\t\t\tthrow new Error('could not find patch context ' + context);\n\t\t}\n\t}\n\n\treturn index;\n}\n},{\"./jsonPointerParse\":17}],17:[function(require,module,exports){\n/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\nmodule.exports = jsonPointerParse;\n\nvar parseRx = /\\/|~1|~0/g;\nvar separator = '/';\nvar escapeChar = '~';\nvar encodedSeparator = '~1';\n\n/**\n * Parse through an encoded JSON Pointer string, decoding each path segment\n * and passing it to an onSegment callback function.\n * @see https://tools.ietf.org/html/rfc6901#section-4\n * @param {string} path encoded JSON Pointer string\n * @param {{function(segment:string):boolean}} onSegment callback function\n * @returns {string} original path\n */\nfunction jsonPointerParse(path, onSegment) {\n\tvar pos, accum, matches, match;\n\n\tpos = path.charAt(0) === separator ? 1 : 0;\n\taccum = '';\n\tparseRx.lastIndex = pos;\n\n\twhile(matches = parseRx.exec(path)) {\n\n\t\tmatch = matches[0];\n\t\taccum += path.slice(pos, parseRx.lastIndex - match.length);\n\t\tpos = parseRx.lastIndex;\n\n\t\tif(match === separator) {\n\t\t\tif (onSegment(accum) === false) return path;\n\t\t\taccum = '';\n\t\t} else {\n\t\t\taccum += match === encodedSeparator ? separator : escapeChar;\n\t\t}\n\t}\n\n\taccum += path.slice(pos);\n\tonSegment(accum);\n\n\treturn path;\n}\n\n},{}],18:[function(require,module,exports){\n/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\nexports.compare = compare;\nexports.reduce = reduce;\n\nvar REMOVE, RIGHT, ADD, DOWN, SKIP;\n\nexports.REMOVE = REMOVE = RIGHT = -1;\nexports.ADD    = ADD    = DOWN  =  1;\nexports.EQUAL  = SKIP   = 0;\n\n/**\n * Create an lcs comparison matrix describing the differences\n * between two array-like sequences\n * @param {array} a array-like\n * @param {array} b array-like\n * @returns {object} lcs descriptor, suitable for passing to reduce()\n */\nfunction compare(a, b) {\n\tvar cols = a.length;\n\tvar rows = b.length;\n\n\tvar prefix = findPrefix(a, b);\n\tvar suffix = prefix < cols && prefix < rows\n\t\t? findSuffix(a, b, prefix)\n\t\t: 0;\n\n\tvar remove = suffix + prefix - 1;\n\tcols -= remove;\n\trows -= remove;\n\tvar matrix = createMatrix(cols, rows);\n\n\tfor (var j = cols - 1; j >= 0; --j) {\n\t\tfor (var i = rows - 1; i >= 0; --i) {\n\t\t\tmatrix[i][j] = backtrack(matrix, a, b, prefix, j, i);\n\t\t}\n\t}\n\n\treturn {\n\t\tprefix: prefix,\n\t\tmatrix: matrix,\n\t\tsuffix: suffix\n\t};\n}\n\n/**\n * Reduce a set of lcs changes previously created using compare\n * @param {function(result:*, type:number, i:number, j:number)} f\n *  reducer function, where:\n *  - result is the current reduce value,\n *  - type is the type of change: ADD, REMOVE, or SKIP\n *  - i is the index of the change location in b\n *  - j is the index of the change location in a\n * @param {*} r initial value\n * @param {object} lcs results returned by compare()\n * @returns {*} the final reduced value\n */\nfunction reduce(f, r, lcs) {\n\tvar i, j, k, op;\n\n\tvar m = lcs.matrix;\n\n\t// Reduce shared prefix\n\tvar l = lcs.prefix;\n\tfor(i = 0;i < l; ++i) {\n\t\tr = f(r, SKIP, i, i);\n\t}\n\n\t// Reduce longest change span\n\tk = i;\n\tl = m.length;\n\ti = 0;\n\tj = 0;\n\twhile(i < l) {\n\t\top = m[i][j].type;\n\t\tr = f(r, op, i+k, j+k);\n\n\t\tswitch(op) {\n\t\t\tcase SKIP:  ++i; ++j; break;\n\t\t\tcase RIGHT: ++j; break;\n\t\t\tcase DOWN:  ++i; break;\n\t\t}\n\t}\n\n\t// Reduce shared suffix\n\ti += k;\n\tj += k;\n\tl = lcs.suffix;\n\tfor(k = 0;k < l; ++k) {\n\t\tr = f(r, SKIP, i+k, j+k);\n\t}\n\n\treturn r;\n}\n\nfunction findPrefix(a, b) {\n\tvar i = 0;\n\tvar l = Math.min(a.length, b.length);\n\twhile(i < l && a[i] === b[i]) {\n\t\t++i;\n\t}\n\treturn i;\n}\n\nfunction findSuffix(a, b) {\n\tvar al = a.length - 1;\n\tvar bl = b.length - 1;\n\tvar l = Math.min(al, bl);\n\tvar i = 0;\n\twhile(i < l && a[al-i] === b[bl-i]) {\n\t\t++i;\n\t}\n\treturn i;\n}\n\nfunction backtrack(matrix, a, b, start, j, i) {\n\tif (a[j+start] === b[i+start]) {\n\t\treturn { value: matrix[i + 1][j + 1].value, type: SKIP };\n\t}\n\tif (matrix[i][j + 1].value < matrix[i + 1][j].value) {\n\t\treturn { value: matrix[i][j + 1].value + 1, type: RIGHT };\n\t}\n\n\treturn { value: matrix[i + 1][j].value + 1, type: DOWN };\n}\n\nfunction createMatrix (cols, rows) {\n\tvar m = [], i, j, lastrow;\n\n\t// Fill the last row\n\tlastrow = m[rows] = [];\n\tfor (j = 0; j<cols; ++j) {\n\t\tlastrow[j] = { value: cols - j, type: RIGHT };\n\t}\n\n\t// Fill the last col\n\tfor (i = 0; i<rows; ++i) {\n\t\tm[i] = [];\n\t\tm[i][cols] = { value: rows - i, type: DOWN };\n\t}\n\n\t// Fill the last cell\n\tm[rows][cols] = { value: 0, type: SKIP };\n\n\treturn m;\n}\n\n},{}],19:[function(require,module,exports){\nvar jsonPointer = require('./jsonPointer');\nvar clone = require('./clone');\nvar deepEquals = require('./deepEquals');\nvar commutePaths = require('./commutePaths');\n\nvar array = require('./array');\n\nvar TestFailedError = require('./TestFailedError');\nvar InvalidPatchOperationError = require('./InvalidPatchOperationError');\nvar PatchNotInvertibleError = require('./PatchNotInvertibleError');\n\nvar find = jsonPointer.find;\nvar parseArrayIndex = jsonPointer.parseArrayIndex;\n\nexports.test = {\n\tapply: applyTest,\n\tinverse: invertTest,\n\tcommute: commuteTest\n};\n\nexports.add = {\n\tapply: applyAdd,\n\tinverse: invertAdd,\n\tcommute: commuteAddOrCopy\n};\n\nexports.remove = {\n\tapply: applyRemove,\n\tinverse: invertRemove,\n\tcommute: commuteRemove\n};\n\nexports.replace = {\n\tapply: applyReplace,\n\tinverse: invertReplace,\n\tcommute: commuteReplace\n};\n\nexports.move = {\n\tapply: applyMove,\n\tinverse: invertMove,\n\tcommute: commuteMove\n};\n\nexports.copy = {\n\tapply: applyCopy,\n\tinverse: notInvertible,\n\tcommute: commuteAddOrCopy\n};\n\n/**\n * Apply a test operation to x\n * @param {object|array} x\n * @param {object} test test operation\n * @throws {TestFailedError} if the test operation fails\n */\n\nfunction applyTest(x, test, options) {\n\tvar pointer = find(x, test.path, options.findContext, test.context);\n\tvar target = pointer.target;\n\tvar index, value;\n\n\tif(Array.isArray(target)) {\n\t\tindex = parseArrayIndex(pointer.key);\n\t\t//index = findIndex(options.findContext, index, target, test.context);\n\t\tvalue = target[index];\n\t} else {\n\t\tvalue = pointer.key === void 0 ? pointer.target : pointer.target[pointer.key];\n\t}\n\n\tif(!deepEquals(value, test.value)) {\n\t\tthrow new TestFailedError('test failed ' + JSON.stringify(test));\n\t}\n\n\treturn x;\n}\n\n/**\n * Invert the provided test and add it to the inverted patch sequence\n * @param pr\n * @param test\n * @returns {number}\n */\nfunction invertTest(pr, test) {\n\tpr.push(test);\n\treturn 1;\n}\n\nfunction commuteTest(test, b) {\n\tif(test.path === b.path && b.op === 'remove') {\n\t\tthrow new TypeError('Can\\'t commute test,remove -> remove,test for same path');\n\t}\n\n\tif(b.op === 'test' || b.op === 'replace') {\n\t\treturn [b, test];\n\t}\n\n\treturn commutePaths(test, b);\n}\n\n/**\n * Apply an add operation to x\n * @param {object|array} x\n * @param {object} change add operation\n */\nfunction applyAdd(x, change, options) {\n\tvar pointer = find(x, change.path, options.findContext, change.context);\n\n\tif(notFound(pointer)) {\n\t\tthrow new InvalidPatchOperationError('path does not exist ' + change.path);\n\t}\n\n\tif(change.value === void 0) {\n\t\tthrow new InvalidPatchOperationError('missing value');\n\t}\n\n\tvar val = clone(change.value);\n\n\t// If pointer refers to whole document, replace whole document\n\tif(pointer.key === void 0) {\n\t\treturn val;\n\t}\n\n\t_add(pointer, val);\n\treturn x;\n}\n\nfunction _add(pointer, value) {\n\tvar target = pointer.target;\n\n\tif(Array.isArray(target)) {\n\t\t// '-' indicates 'append' to array\n\t\tif(pointer.key === '-') {\n\t\t\ttarget.push(value);\n\t\t} else if (pointer.key > target.length) {\n\t\t\tthrow new InvalidPatchOperationError('target of add outside of array bounds')\n\t\t} else {\n\t\t\ttarget.splice(pointer.key, 0, value);\n\t\t}\n\t} else if(isValidObject(target)) {\n\t\ttarget[pointer.key] = value;\n\t} else {\n\t\tthrow new InvalidPatchOperationError('target of add must be an object or array ' + pointer.key);\n\t}\n}\n\nfunction invertAdd(pr, add) {\n\tvar context = add.context;\n\tif(context !== void 0) {\n\t\tcontext = {\n\t\t\tbefore: context.before,\n\t\t\tafter: array.cons(add.value, context.after)\n\t\t}\n\t}\n\tpr.push({ op: 'test', path: add.path, value: add.value, context: context });\n\tpr.push({ op: 'remove', path: add.path, context: context });\n\treturn 1;\n}\n\nfunction commuteAddOrCopy(add, b) {\n\tif(add.path === b.path && b.op === 'remove') {\n\t\tthrow new TypeError('Can\\'t commute add,remove -> remove,add for same path');\n\t}\n\n\treturn commutePaths(add, b);\n}\n\n/**\n * Apply a replace operation to x\n * @param {object|array} x\n * @param {object} change replace operation\n */\nfunction applyReplace(x, change, options) {\n\tvar pointer = find(x, change.path, options.findContext, change.context);\n\n\tif(notFound(pointer) || missingValue(pointer)) {\n\t\tthrow new InvalidPatchOperationError('path does not exist ' + change.path);\n\t}\n\n\tif(change.value === void 0) {\n\t\tthrow new InvalidPatchOperationError('missing value');\n\t}\n\n\tvar value = clone(change.value);\n\n\t// If pointer refers to whole document, replace whole document\n\tif(pointer.key === void 0) {\n\t\treturn value;\n\t}\n\n\tvar target = pointer.target;\n\n\tif(Array.isArray(target)) {\n\t\ttarget[parseArrayIndex(pointer.key)] = value;\n\t} else {\n\t\ttarget[pointer.key] = value;\n\t}\n\n\treturn x;\n}\n\nfunction invertReplace(pr, c, i, patch) {\n\tvar prev = patch[i-1];\n\tif(prev === void 0 || prev.op !== 'test' || prev.path !== c.path) {\n\t\tthrow new PatchNotInvertibleError('cannot invert replace w/o test');\n\t}\n\n\tvar context = prev.context;\n\tif(context !== void 0) {\n\t\tcontext = {\n\t\t\tbefore: context.before,\n\t\t\tafter: array.cons(prev.value, array.tail(context.after))\n\t\t}\n\t}\n\n\tpr.push({ op: 'test', path: prev.path, value: c.value });\n\tpr.push({ op: 'replace', path: prev.path, value: prev.value });\n\treturn 2;\n}\n\nfunction commuteReplace(replace, b) {\n\tif(replace.path === b.path && b.op === 'remove') {\n\t\tthrow new TypeError('Can\\'t commute replace,remove -> remove,replace for same path');\n\t}\n\n\tif(b.op === 'test' || b.op === 'replace') {\n\t\treturn [b, replace];\n\t}\n\n\treturn commutePaths(replace, b);\n}\n\n/**\n * Apply a remove operation to x\n * @param {object|array} x\n * @param {object} change remove operation\n */\nfunction applyRemove(x, change, options) {\n\tvar pointer = find(x, change.path, options.findContext, change.context);\n\n\t// key must exist for remove\n\tif(notFound(pointer) || pointer.target[pointer.key] === void 0) {\n\t\tthrow new InvalidPatchOperationError('path does not exist ' + change.path);\n\t}\n\n\t_remove(pointer);\n\treturn x;\n}\n\nfunction _remove (pointer) {\n\tvar target = pointer.target;\n\n\tvar removed;\n\tif (Array.isArray(target)) {\n\t\tremoved = target.splice(parseArrayIndex(pointer.key), 1);\n\t\treturn removed[0];\n\n\t} else if (isValidObject(target)) {\n\t\tremoved = target[pointer.key];\n\t\tdelete target[pointer.key];\n\t\treturn removed;\n\n\t} else {\n\t\tthrow new InvalidPatchOperationError('target of remove must be an object or array');\n\t}\n}\n\nfunction invertRemove(pr, c, i, patch) {\n\tvar prev = patch[i-1];\n\tif(prev === void 0 || prev.op !== 'test' || prev.path !== c.path) {\n\t\tthrow new PatchNotInvertibleError('cannot invert remove w/o test');\n\t}\n\n\tvar context = prev.context;\n\tif(context !== void 0) {\n\t\tcontext = {\n\t\t\tbefore: context.before,\n\t\t\tafter: array.tail(context.after)\n\t\t}\n\t}\n\n\tpr.push({ op: 'add', path: prev.path, value: prev.value, context: context });\n\treturn 2;\n}\n\nfunction commuteRemove(remove, b) {\n\tif(remove.path === b.path && b.op === 'remove') {\n\t\treturn [b, remove];\n\t}\n\n\treturn commutePaths(remove, b);\n}\n\n/**\n * Apply a move operation to x\n * @param {object|array} x\n * @param {object} change move operation\n */\nfunction applyMove(x, change, options) {\n\tif(jsonPointer.contains(change.path, change.from)) {\n\t\tthrow new InvalidPatchOperationError('move.from cannot be ancestor of move.path');\n\t}\n\n\tvar pto = find(x, change.path, options.findContext, change.context);\n\tvar pfrom = find(x, change.from, options.findContext, change.fromContext);\n\n\t_add(pto, _remove(pfrom));\n\treturn x;\n}\n\nfunction invertMove(pr, c) {\n\tpr.push({ op: 'move',\n\t\tpath: c.from, context: c.fromContext,\n\t\tfrom: c.path, fromContext: c.context });\n\treturn 1;\n}\n\nfunction commuteMove(move, b) {\n\tif(move.path === b.path && b.op === 'remove') {\n\t\tthrow new TypeError('Can\\'t commute move,remove -> move,replace for same path');\n\t}\n\n\treturn commutePaths(move, b);\n}\n\n/**\n * Apply a copy operation to x\n * @param {object|array} x\n * @param {object} change copy operation\n */\nfunction applyCopy(x, change, options) {\n\tvar pto = find(x, change.path, options.findContext, change.context);\n\tvar pfrom = find(x, change.from, options.findContext, change.fromContext);\n\n\tif(notFound(pfrom) || missingValue(pfrom)) {\n\t\tthrow new InvalidPatchOperationError('copy.from must exist');\n\t}\n\n\tvar target = pfrom.target;\n\tvar value;\n\n\tif(Array.isArray(target)) {\n\t\tvalue = target[parseArrayIndex(pfrom.key)];\n\t} else {\n\t\tvalue = target[pfrom.key];\n\t}\n\n\t_add(pto, clone(value));\n\treturn x;\n}\n\n// NOTE: Copy is not invertible\n// See https://github.com/cujojs/jiff/issues/9\n// This needs more thought. We may have to extend/amend JSON Patch.\n// At first glance, this seems like it should just be a remove.\n// However, that's not correct.  It violates the involution:\n// invert(invert(p)) ~= p.  For example:\n// invert(copy) -> remove\n// invert(remove) -> add\n// thus: invert(invert(copy)) -> add (DOH! this should be copy!)\n\nfunction notInvertible(_, c) {\n\tthrow new PatchNotInvertibleError('cannot invert ' + c.op);\n}\n\nfunction notFound (pointer) {\n\treturn pointer === void 0 || (pointer.target == null && pointer.key !== void 0);\n}\n\nfunction missingValue(pointer) {\n\treturn pointer.key !== void 0 && pointer.target[pointer.key] === void 0;\n}\n\n/**\n * Return true if x is a non-null object\n * @param {*} x\n * @returns {boolean}\n */\nfunction isValidObject (x) {\n\treturn x !== null && typeof x === 'object';\n}\n\n},{\"./InvalidPatchOperationError\":7,\"./PatchNotInvertibleError\":8,\"./TestFailedError\":9,\"./array\":10,\"./clone\":11,\"./commutePaths\":12,\"./deepEquals\":13,\"./jsonPointer\":16}],20:[function(require,module,exports){\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],21:[function(require,module,exports){\n(function (process){\n// vim:ts=4:sts=4:sw=4:\n/*!\n *\n * Copyright 2009-2017 Kris Kowal under the terms of the MIT\n * license found at https://github.com/kriskowal/q/blob/v1/LICENSE\n *\n * With parts by Tyler Close\n * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found\n * at http://www.opensource.org/licenses/mit-license.html\n * Forked at ref_send.js version: 2009-05-11\n *\n * With parts by Mark Miller\n * Copyright (C) 2011 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\n(function (definition) {\n    \"use strict\";\n\n    // This file will function properly as a <script> tag, or a module\n    // using CommonJS and NodeJS or RequireJS module formats.  In\n    // Common/Node/RequireJS, the module exports the Q API and when\n    // executed as a simple <script>, it creates a Q global instead.\n\n    // Montage Require\n    if (typeof bootstrap === \"function\") {\n        bootstrap(\"promise\", definition);\n\n    // CommonJS\n    } else if (typeof exports === \"object\" && typeof module === \"object\") {\n        module.exports = definition();\n\n    // RequireJS\n    } else if (typeof define === \"function\" && define.amd) {\n        define(definition);\n\n    // SES (Secure EcmaScript)\n    } else if (typeof ses !== \"undefined\") {\n        if (!ses.ok()) {\n            return;\n        } else {\n            ses.makeQ = definition;\n        }\n\n    // <script>\n    } else if (typeof window !== \"undefined\" || typeof self !== \"undefined\") {\n        // Prefer window over self for add-on scripts. Use self for\n        // non-windowed contexts.\n        var global = typeof window !== \"undefined\" ? window : self;\n\n        // Get the `window` object, save the previous Q global\n        // and initialize Q as a global.\n        var previousQ = global.Q;\n        global.Q = definition();\n\n        // Add a noConflict function so Q can be removed from the\n        // global namespace.\n        global.Q.noConflict = function () {\n            global.Q = previousQ;\n            return this;\n        };\n\n    } else {\n        throw new Error(\"This environment was not anticipated by Q. Please file a bug.\");\n    }\n\n})(function () {\n\"use strict\";\n\nvar hasStacks = false;\ntry {\n    throw new Error();\n} catch (e) {\n    hasStacks = !!e.stack;\n}\n\n// All code after this point will be filtered from stack traces reported\n// by Q.\nvar qStartingLine = captureLine();\nvar qFileName;\n\n// shims\n\n// used for fallback in \"allResolved\"\nvar noop = function () {};\n\n// Use the fastest possible means to execute a task in a future turn\n// of the event loop.\nvar nextTick =(function () {\n    // linked list of tasks (single, with head node)\n    var head = {task: void 0, next: null};\n    var tail = head;\n    var flushing = false;\n    var requestTick = void 0;\n    var isNodeJS = false;\n    // queue for late tasks, used by unhandled rejection tracking\n    var laterQueue = [];\n\n    function flush() {\n        /* jshint loopfunc: true */\n        var task, domain;\n\n        while (head.next) {\n            head = head.next;\n            task = head.task;\n            head.task = void 0;\n            domain = head.domain;\n\n            if (domain) {\n                head.domain = void 0;\n                domain.enter();\n            }\n            runSingle(task, domain);\n\n        }\n        while (laterQueue.length) {\n            task = laterQueue.pop();\n            runSingle(task);\n        }\n        flushing = false;\n    }\n    // runs a single function in the async queue\n    function runSingle(task, domain) {\n        try {\n            task();\n\n        } catch (e) {\n            if (isNodeJS) {\n                // In node, uncaught exceptions are considered fatal errors.\n                // Re-throw them synchronously to interrupt flushing!\n\n                // Ensure continuation if the uncaught exception is suppressed\n                // listening \"uncaughtException\" events (as domains does).\n                // Continue in next event to avoid tick recursion.\n                if (domain) {\n                    domain.exit();\n                }\n                setTimeout(flush, 0);\n                if (domain) {\n                    domain.enter();\n                }\n\n                throw e;\n\n            } else {\n                // In browsers, uncaught exceptions are not fatal.\n                // Re-throw them asynchronously to avoid slow-downs.\n                setTimeout(function () {\n                    throw e;\n                }, 0);\n            }\n        }\n\n        if (domain) {\n            domain.exit();\n        }\n    }\n\n    nextTick = function (task) {\n        tail = tail.next = {\n            task: task,\n            domain: isNodeJS && process.domain,\n            next: null\n        };\n\n        if (!flushing) {\n            flushing = true;\n            requestTick();\n        }\n    };\n\n    if (typeof process === \"object\" &&\n        process.toString() === \"[object process]\" && process.nextTick) {\n        // Ensure Q is in a real Node environment, with a `process.nextTick`.\n        // To see through fake Node environments:\n        // * Mocha test runner - exposes a `process` global without a `nextTick`\n        // * Browserify - exposes a `process.nexTick` function that uses\n        //   `setTimeout`. In this case `setImmediate` is preferred because\n        //    it is faster. Browserify's `process.toString()` yields\n        //   \"[object Object]\", while in a real Node environment\n        //   `process.toString()` yields \"[object process]\".\n        isNodeJS = true;\n\n        requestTick = function () {\n            process.nextTick(flush);\n        };\n\n    } else if (typeof setImmediate === \"function\") {\n        // In IE10, Node.js 0.9+, or https://github.com/NobleJS/setImmediate\n        if (typeof window !== \"undefined\") {\n            requestTick = setImmediate.bind(window, flush);\n        } else {\n            requestTick = function () {\n                setImmediate(flush);\n            };\n        }\n\n    } else if (typeof MessageChannel !== \"undefined\") {\n        // modern browsers\n        // http://www.nonblocking.io/2011/06/windownexttick.html\n        var channel = new MessageChannel();\n        // At least Safari Version 6.0.5 (8536.30.1) intermittently cannot create\n        // working message ports the first time a page loads.\n        channel.port1.onmessage = function () {\n            requestTick = requestPortTick;\n            channel.port1.onmessage = flush;\n            flush();\n        };\n        var requestPortTick = function () {\n            // Opera requires us to provide a message payload, regardless of\n            // whether we use it.\n            channel.port2.postMessage(0);\n        };\n        requestTick = function () {\n            setTimeout(flush, 0);\n            requestPortTick();\n        };\n\n    } else {\n        // old browsers\n        requestTick = function () {\n            setTimeout(flush, 0);\n        };\n    }\n    // runs a task after all other tasks have been run\n    // this is useful for unhandled rejection tracking that needs to happen\n    // after all `then`d tasks have been run.\n    nextTick.runAfter = function (task) {\n        laterQueue.push(task);\n        if (!flushing) {\n            flushing = true;\n            requestTick();\n        }\n    };\n    return nextTick;\n})();\n\n// Attempt to make generics safe in the face of downstream\n// modifications.\n// There is no situation where this is necessary.\n// If you need a security guarantee, these primordials need to be\n// deeply frozen anyway, and if you dont need a security guarantee,\n// this is just plain paranoid.\n// However, this **might** have the nice side-effect of reducing the size of\n// the minified code by reducing x.call() to merely x()\n// See Mark Millers explanation of what this does.\n// http://wiki.ecmascript.org/doku.php?id=conventions:safe_meta_programming\nvar call = Function.call;\nfunction uncurryThis(f) {\n    return function () {\n        return call.apply(f, arguments);\n    };\n}\n// This is equivalent, but slower:\n// uncurryThis = Function_bind.bind(Function_bind.call);\n// http://jsperf.com/uncurrythis\n\nvar array_slice = uncurryThis(Array.prototype.slice);\n\nvar array_reduce = uncurryThis(\n    Array.prototype.reduce || function (callback, basis) {\n        var index = 0,\n            length = this.length;\n        // concerning the initial value, if one is not provided\n        if (arguments.length === 1) {\n            // seek to the first value in the array, accounting\n            // for the possibility that is is a sparse array\n            do {\n                if (index in this) {\n                    basis = this[index++];\n                    break;\n                }\n                if (++index >= length) {\n                    throw new TypeError();\n                }\n            } while (1);\n        }\n        // reduce\n        for (; index < length; index++) {\n            // account for the possibility that the array is sparse\n            if (index in this) {\n                basis = callback(basis, this[index], index);\n            }\n        }\n        return basis;\n    }\n);\n\nvar array_indexOf = uncurryThis(\n    Array.prototype.indexOf || function (value) {\n        // not a very good shim, but good enough for our one use of it\n        for (var i = 0; i < this.length; i++) {\n            if (this[i] === value) {\n                return i;\n            }\n        }\n        return -1;\n    }\n);\n\nvar array_map = uncurryThis(\n    Array.prototype.map || function (callback, thisp) {\n        var self = this;\n        var collect = [];\n        array_reduce(self, function (undefined, value, index) {\n            collect.push(callback.call(thisp, value, index, self));\n        }, void 0);\n        return collect;\n    }\n);\n\nvar object_create = Object.create || function (prototype) {\n    function Type() { }\n    Type.prototype = prototype;\n    return new Type();\n};\n\nvar object_defineProperty = Object.defineProperty || function (obj, prop, descriptor) {\n    obj[prop] = descriptor.value;\n    return obj;\n};\n\nvar object_hasOwnProperty = uncurryThis(Object.prototype.hasOwnProperty);\n\nvar object_keys = Object.keys || function (object) {\n    var keys = [];\n    for (var key in object) {\n        if (object_hasOwnProperty(object, key)) {\n            keys.push(key);\n        }\n    }\n    return keys;\n};\n\nvar object_toString = uncurryThis(Object.prototype.toString);\n\nfunction isObject(value) {\n    return value === Object(value);\n}\n\n// generator related shims\n\n// FIXME: Remove this function once ES6 generators are in SpiderMonkey.\nfunction isStopIteration(exception) {\n    return (\n        object_toString(exception) === \"[object StopIteration]\" ||\n        exception instanceof QReturnValue\n    );\n}\n\n// FIXME: Remove this helper and Q.return once ES6 generators are in\n// SpiderMonkey.\nvar QReturnValue;\nif (typeof ReturnValue !== \"undefined\") {\n    QReturnValue = ReturnValue;\n} else {\n    QReturnValue = function (value) {\n        this.value = value;\n    };\n}\n\n// long stack traces\n\nvar STACK_JUMP_SEPARATOR = \"From previous event:\";\n\nfunction makeStackTraceLong(error, promise) {\n    // If possible, transform the error stack trace by removing Node and Q\n    // cruft, then concatenating with the stack trace of `promise`. See #57.\n    if (hasStacks &&\n        promise.stack &&\n        typeof error === \"object\" &&\n        error !== null &&\n        error.stack\n    ) {\n        var stacks = [];\n        for (var p = promise; !!p; p = p.source) {\n            if (p.stack && (!error.__minimumStackCounter__ || error.__minimumStackCounter__ > p.stackCounter)) {\n                object_defineProperty(error, \"__minimumStackCounter__\", {value: p.stackCounter, configurable: true});\n                stacks.unshift(p.stack);\n            }\n        }\n        stacks.unshift(error.stack);\n\n        var concatedStacks = stacks.join(\"\\n\" + STACK_JUMP_SEPARATOR + \"\\n\");\n        var stack = filterStackString(concatedStacks);\n        object_defineProperty(error, \"stack\", {value: stack, configurable: true});\n    }\n}\n\nfunction filterStackString(stackString) {\n    var lines = stackString.split(\"\\n\");\n    var desiredLines = [];\n    for (var i = 0; i < lines.length; ++i) {\n        var line = lines[i];\n\n        if (!isInternalFrame(line) && !isNodeFrame(line) && line) {\n            desiredLines.push(line);\n        }\n    }\n    return desiredLines.join(\"\\n\");\n}\n\nfunction isNodeFrame(stackLine) {\n    return stackLine.indexOf(\"(module.js:\") !== -1 ||\n           stackLine.indexOf(\"(node.js:\") !== -1;\n}\n\nfunction getFileNameAndLineNumber(stackLine) {\n    // Named functions: \"at functionName (filename:lineNumber:columnNumber)\"\n    // In IE10 function name can have spaces (\"Anonymous function\") O_o\n    var attempt1 = /at .+ \\((.+):(\\d+):(?:\\d+)\\)$/.exec(stackLine);\n    if (attempt1) {\n        return [attempt1[1], Number(attempt1[2])];\n    }\n\n    // Anonymous functions: \"at filename:lineNumber:columnNumber\"\n    var attempt2 = /at ([^ ]+):(\\d+):(?:\\d+)$/.exec(stackLine);\n    if (attempt2) {\n        return [attempt2[1], Number(attempt2[2])];\n    }\n\n    // Firefox style: \"function@filename:lineNumber or @filename:lineNumber\"\n    var attempt3 = /.*@(.+):(\\d+)$/.exec(stackLine);\n    if (attempt3) {\n        return [attempt3[1], Number(attempt3[2])];\n    }\n}\n\nfunction isInternalFrame(stackLine) {\n    var fileNameAndLineNumber = getFileNameAndLineNumber(stackLine);\n\n    if (!fileNameAndLineNumber) {\n        return false;\n    }\n\n    var fileName = fileNameAndLineNumber[0];\n    var lineNumber = fileNameAndLineNumber[1];\n\n    return fileName === qFileName &&\n        lineNumber >= qStartingLine &&\n        lineNumber <= qEndingLine;\n}\n\n// discover own file name and line number range for filtering stack\n// traces\nfunction captureLine() {\n    if (!hasStacks) {\n        return;\n    }\n\n    try {\n        throw new Error();\n    } catch (e) {\n        var lines = e.stack.split(\"\\n\");\n        var firstLine = lines[0].indexOf(\"@\") > 0 ? lines[1] : lines[2];\n        var fileNameAndLineNumber = getFileNameAndLineNumber(firstLine);\n        if (!fileNameAndLineNumber) {\n            return;\n        }\n\n        qFileName = fileNameAndLineNumber[0];\n        return fileNameAndLineNumber[1];\n    }\n}\n\nfunction deprecate(callback, name, alternative) {\n    return function () {\n        if (typeof console !== \"undefined\" &&\n            typeof console.warn === \"function\") {\n            console.warn(name + \" is deprecated, use \" + alternative +\n                         \" instead.\", new Error(\"\").stack);\n        }\n        return callback.apply(callback, arguments);\n    };\n}\n\n// end of shims\n// beginning of real work\n\n/**\n * Constructs a promise for an immediate reference, passes promises through, or\n * coerces promises from different systems.\n * @param value immediate reference or promise\n */\nfunction Q(value) {\n    // If the object is already a Promise, return it directly.  This enables\n    // the resolve function to both be used to created references from objects,\n    // but to tolerably coerce non-promises to promises.\n    if (value instanceof Promise) {\n        return value;\n    }\n\n    // assimilate thenables\n    if (isPromiseAlike(value)) {\n        return coerce(value);\n    } else {\n        return fulfill(value);\n    }\n}\nQ.resolve = Q;\n\n/**\n * Performs a task in a future turn of the event loop.\n * @param {Function} task\n */\nQ.nextTick = nextTick;\n\n/**\n * Controls whether or not long stack traces will be on\n */\nQ.longStackSupport = false;\n\n/**\n * The counter is used to determine the stopping point for building\n * long stack traces. In makeStackTraceLong we walk backwards through\n * the linked list of promises, only stacks which were created before\n * the rejection are concatenated.\n */\nvar longStackCounter = 1;\n\n// enable long stacks if Q_DEBUG is set\nif (typeof process === \"object\" && process && process.env && process.env.Q_DEBUG) {\n    Q.longStackSupport = true;\n}\n\n/**\n * Constructs a {promise, resolve, reject} object.\n *\n * `resolve` is a callback to invoke with a more resolved value for the\n * promise. To fulfill the promise, invoke `resolve` with any value that is\n * not a thenable. To reject the promise, invoke `resolve` with a rejected\n * thenable, or invoke `reject` with the reason directly. To resolve the\n * promise to another thenable, thus putting it in the same state, invoke\n * `resolve` with that other thenable.\n */\nQ.defer = defer;\nfunction defer() {\n    // if \"messages\" is an \"Array\", that indicates that the promise has not yet\n    // been resolved.  If it is \"undefined\", it has been resolved.  Each\n    // element of the messages array is itself an array of complete arguments to\n    // forward to the resolved promise.  We coerce the resolution value to a\n    // promise using the `resolve` function because it handles both fully\n    // non-thenable values and other thenables gracefully.\n    var messages = [], progressListeners = [], resolvedPromise;\n\n    var deferred = object_create(defer.prototype);\n    var promise = object_create(Promise.prototype);\n\n    promise.promiseDispatch = function (resolve, op, operands) {\n        var args = array_slice(arguments);\n        if (messages) {\n            messages.push(args);\n            if (op === \"when\" && operands[1]) { // progress operand\n                progressListeners.push(operands[1]);\n            }\n        } else {\n            Q.nextTick(function () {\n                resolvedPromise.promiseDispatch.apply(resolvedPromise, args);\n            });\n        }\n    };\n\n    // XXX deprecated\n    promise.valueOf = function () {\n        if (messages) {\n            return promise;\n        }\n        var nearerValue = nearer(resolvedPromise);\n        if (isPromise(nearerValue)) {\n            resolvedPromise = nearerValue; // shorten chain\n        }\n        return nearerValue;\n    };\n\n    promise.inspect = function () {\n        if (!resolvedPromise) {\n            return { state: \"pending\" };\n        }\n        return resolvedPromise.inspect();\n    };\n\n    if (Q.longStackSupport && hasStacks) {\n        try {\n            throw new Error();\n        } catch (e) {\n            // NOTE: don't try to use `Error.captureStackTrace` or transfer the\n            // accessor around; that causes memory leaks as per GH-111. Just\n            // reify the stack trace as a string ASAP.\n            //\n            // At the same time, cut off the first line; it's always just\n            // \"[object Promise]\\n\", as per the `toString`.\n            promise.stack = e.stack.substring(e.stack.indexOf(\"\\n\") + 1);\n            promise.stackCounter = longStackCounter++;\n        }\n    }\n\n    // NOTE: we do the checks for `resolvedPromise` in each method, instead of\n    // consolidating them into `become`, since otherwise we'd create new\n    // promises with the lines `become(whatever(value))`. See e.g. GH-252.\n\n    function become(newPromise) {\n        resolvedPromise = newPromise;\n\n        if (Q.longStackSupport && hasStacks) {\n            // Only hold a reference to the new promise if long stacks\n            // are enabled to reduce memory usage\n            promise.source = newPromise;\n        }\n\n        array_reduce(messages, function (undefined, message) {\n            Q.nextTick(function () {\n                newPromise.promiseDispatch.apply(newPromise, message);\n            });\n        }, void 0);\n\n        messages = void 0;\n        progressListeners = void 0;\n    }\n\n    deferred.promise = promise;\n    deferred.resolve = function (value) {\n        if (resolvedPromise) {\n            return;\n        }\n\n        become(Q(value));\n    };\n\n    deferred.fulfill = function (value) {\n        if (resolvedPromise) {\n            return;\n        }\n\n        become(fulfill(value));\n    };\n    deferred.reject = function (reason) {\n        if (resolvedPromise) {\n            return;\n        }\n\n        become(reject(reason));\n    };\n    deferred.notify = function (progress) {\n        if (resolvedPromise) {\n            return;\n        }\n\n        array_reduce(progressListeners, function (undefined, progressListener) {\n            Q.nextTick(function () {\n                progressListener(progress);\n            });\n        }, void 0);\n    };\n\n    return deferred;\n}\n\n/**\n * Creates a Node-style callback that will resolve or reject the deferred\n * promise.\n * @returns a nodeback\n */\ndefer.prototype.makeNodeResolver = function () {\n    var self = this;\n    return function (error, value) {\n        if (error) {\n            self.reject(error);\n        } else if (arguments.length > 2) {\n            self.resolve(array_slice(arguments, 1));\n        } else {\n            self.resolve(value);\n        }\n    };\n};\n\n/**\n * @param resolver {Function} a function that returns nothing and accepts\n * the resolve, reject, and notify functions for a deferred.\n * @returns a promise that may be resolved with the given resolve and reject\n * functions, or rejected by a thrown exception in resolver\n */\nQ.Promise = promise; // ES6\nQ.promise = promise;\nfunction promise(resolver) {\n    if (typeof resolver !== \"function\") {\n        throw new TypeError(\"resolver must be a function.\");\n    }\n    var deferred = defer();\n    try {\n        resolver(deferred.resolve, deferred.reject, deferred.notify);\n    } catch (reason) {\n        deferred.reject(reason);\n    }\n    return deferred.promise;\n}\n\npromise.race = race; // ES6\npromise.all = all; // ES6\npromise.reject = reject; // ES6\npromise.resolve = Q; // ES6\n\n// XXX experimental.  This method is a way to denote that a local value is\n// serializable and should be immediately dispatched to a remote upon request,\n// instead of passing a reference.\nQ.passByCopy = function (object) {\n    //freeze(object);\n    //passByCopies.set(object, true);\n    return object;\n};\n\nPromise.prototype.passByCopy = function () {\n    //freeze(object);\n    //passByCopies.set(object, true);\n    return this;\n};\n\n/**\n * If two promises eventually fulfill to the same value, promises that value,\n * but otherwise rejects.\n * @param x {Any*}\n * @param y {Any*}\n * @returns {Any*} a promise for x and y if they are the same, but a rejection\n * otherwise.\n *\n */\nQ.join = function (x, y) {\n    return Q(x).join(y);\n};\n\nPromise.prototype.join = function (that) {\n    return Q([this, that]).spread(function (x, y) {\n        if (x === y) {\n            // TODO: \"===\" should be Object.is or equiv\n            return x;\n        } else {\n            throw new Error(\"Q can't join: not the same: \" + x + \" \" + y);\n        }\n    });\n};\n\n/**\n * Returns a promise for the first of an array of promises to become settled.\n * @param answers {Array[Any*]} promises to race\n * @returns {Any*} the first promise to be settled\n */\nQ.race = race;\nfunction race(answerPs) {\n    return promise(function (resolve, reject) {\n        // Switch to this once we can assume at least ES5\n        // answerPs.forEach(function (answerP) {\n        //     Q(answerP).then(resolve, reject);\n        // });\n        // Use this in the meantime\n        for (var i = 0, len = answerPs.length; i < len; i++) {\n            Q(answerPs[i]).then(resolve, reject);\n        }\n    });\n}\n\nPromise.prototype.race = function () {\n    return this.then(Q.race);\n};\n\n/**\n * Constructs a Promise with a promise descriptor object and optional fallback\n * function.  The descriptor contains methods like when(rejected), get(name),\n * set(name, value), post(name, args), and delete(name), which all\n * return either a value, a promise for a value, or a rejection.  The fallback\n * accepts the operation name, a resolver, and any further arguments that would\n * have been forwarded to the appropriate method above had a method been\n * provided with the proper name.  The API makes no guarantees about the nature\n * of the returned object, apart from that it is usable whereever promises are\n * bought and sold.\n */\nQ.makePromise = Promise;\nfunction Promise(descriptor, fallback, inspect) {\n    if (fallback === void 0) {\n        fallback = function (op) {\n            return reject(new Error(\n                \"Promise does not support operation: \" + op\n            ));\n        };\n    }\n    if (inspect === void 0) {\n        inspect = function () {\n            return {state: \"unknown\"};\n        };\n    }\n\n    var promise = object_create(Promise.prototype);\n\n    promise.promiseDispatch = function (resolve, op, args) {\n        var result;\n        try {\n            if (descriptor[op]) {\n                result = descriptor[op].apply(promise, args);\n            } else {\n                result = fallback.call(promise, op, args);\n            }\n        } catch (exception) {\n            result = reject(exception);\n        }\n        if (resolve) {\n            resolve(result);\n        }\n    };\n\n    promise.inspect = inspect;\n\n    // XXX deprecated `valueOf` and `exception` support\n    if (inspect) {\n        var inspected = inspect();\n        if (inspected.state === \"rejected\") {\n            promise.exception = inspected.reason;\n        }\n\n        promise.valueOf = function () {\n            var inspected = inspect();\n            if (inspected.state === \"pending\" ||\n                inspected.state === \"rejected\") {\n                return promise;\n            }\n            return inspected.value;\n        };\n    }\n\n    return promise;\n}\n\nPromise.prototype.toString = function () {\n    return \"[object Promise]\";\n};\n\nPromise.prototype.then = function (fulfilled, rejected, progressed) {\n    var self = this;\n    var deferred = defer();\n    var done = false;   // ensure the untrusted promise makes at most a\n                        // single call to one of the callbacks\n\n    function _fulfilled(value) {\n        try {\n            return typeof fulfilled === \"function\" ? fulfilled(value) : value;\n        } catch (exception) {\n            return reject(exception);\n        }\n    }\n\n    function _rejected(exception) {\n        if (typeof rejected === \"function\") {\n            makeStackTraceLong(exception, self);\n            try {\n                return rejected(exception);\n            } catch (newException) {\n                return reject(newException);\n            }\n        }\n        return reject(exception);\n    }\n\n    function _progressed(value) {\n        return typeof progressed === \"function\" ? progressed(value) : value;\n    }\n\n    Q.nextTick(function () {\n        self.promiseDispatch(function (value) {\n            if (done) {\n                return;\n            }\n            done = true;\n\n            deferred.resolve(_fulfilled(value));\n        }, \"when\", [function (exception) {\n            if (done) {\n                return;\n            }\n            done = true;\n\n            deferred.resolve(_rejected(exception));\n        }]);\n    });\n\n    // Progress propagator need to be attached in the current tick.\n    self.promiseDispatch(void 0, \"when\", [void 0, function (value) {\n        var newValue;\n        var threw = false;\n        try {\n            newValue = _progressed(value);\n        } catch (e) {\n            threw = true;\n            if (Q.onerror) {\n                Q.onerror(e);\n            } else {\n                throw e;\n            }\n        }\n\n        if (!threw) {\n            deferred.notify(newValue);\n        }\n    }]);\n\n    return deferred.promise;\n};\n\nQ.tap = function (promise, callback) {\n    return Q(promise).tap(callback);\n};\n\n/**\n * Works almost like \"finally\", but not called for rejections.\n * Original resolution value is passed through callback unaffected.\n * Callback may return a promise that will be awaited for.\n * @param {Function} callback\n * @returns {Q.Promise}\n * @example\n * doSomething()\n *   .then(...)\n *   .tap(console.log)\n *   .then(...);\n */\nPromise.prototype.tap = function (callback) {\n    callback = Q(callback);\n\n    return this.then(function (value) {\n        return callback.fcall(value).thenResolve(value);\n    });\n};\n\n/**\n * Registers an observer on a promise.\n *\n * Guarantees:\n *\n * 1. that fulfilled and rejected will be called only once.\n * 2. that either the fulfilled callback or the rejected callback will be\n *    called, but not both.\n * 3. that fulfilled and rejected will not be called in this turn.\n *\n * @param value      promise or immediate reference to observe\n * @param fulfilled  function to be called with the fulfilled value\n * @param rejected   function to be called with the rejection exception\n * @param progressed function to be called on any progress notifications\n * @return promise for the return value from the invoked callback\n */\nQ.when = when;\nfunction when(value, fulfilled, rejected, progressed) {\n    return Q(value).then(fulfilled, rejected, progressed);\n}\n\nPromise.prototype.thenResolve = function (value) {\n    return this.then(function () { return value; });\n};\n\nQ.thenResolve = function (promise, value) {\n    return Q(promise).thenResolve(value);\n};\n\nPromise.prototype.thenReject = function (reason) {\n    return this.then(function () { throw reason; });\n};\n\nQ.thenReject = function (promise, reason) {\n    return Q(promise).thenReject(reason);\n};\n\n/**\n * If an object is not a promise, it is as \"near\" as possible.\n * If a promise is rejected, it is as \"near\" as possible too.\n * If its a fulfilled promise, the fulfillment value is nearer.\n * If its a deferred promise and the deferred has been resolved, the\n * resolution is \"nearer\".\n * @param object\n * @returns most resolved (nearest) form of the object\n */\n\n// XXX should we re-do this?\nQ.nearer = nearer;\nfunction nearer(value) {\n    if (isPromise(value)) {\n        var inspected = value.inspect();\n        if (inspected.state === \"fulfilled\") {\n            return inspected.value;\n        }\n    }\n    return value;\n}\n\n/**\n * @returns whether the given object is a promise.\n * Otherwise it is a fulfilled value.\n */\nQ.isPromise = isPromise;\nfunction isPromise(object) {\n    return object instanceof Promise;\n}\n\nQ.isPromiseAlike = isPromiseAlike;\nfunction isPromiseAlike(object) {\n    return isObject(object) && typeof object.then === \"function\";\n}\n\n/**\n * @returns whether the given object is a pending promise, meaning not\n * fulfilled or rejected.\n */\nQ.isPending = isPending;\nfunction isPending(object) {\n    return isPromise(object) && object.inspect().state === \"pending\";\n}\n\nPromise.prototype.isPending = function () {\n    return this.inspect().state === \"pending\";\n};\n\n/**\n * @returns whether the given object is a value or fulfilled\n * promise.\n */\nQ.isFulfilled = isFulfilled;\nfunction isFulfilled(object) {\n    return !isPromise(object) || object.inspect().state === \"fulfilled\";\n}\n\nPromise.prototype.isFulfilled = function () {\n    return this.inspect().state === \"fulfilled\";\n};\n\n/**\n * @returns whether the given object is a rejected promise.\n */\nQ.isRejected = isRejected;\nfunction isRejected(object) {\n    return isPromise(object) && object.inspect().state === \"rejected\";\n}\n\nPromise.prototype.isRejected = function () {\n    return this.inspect().state === \"rejected\";\n};\n\n//// BEGIN UNHANDLED REJECTION TRACKING\n\n// This promise library consumes exceptions thrown in handlers so they can be\n// handled by a subsequent promise.  The exceptions get added to this array when\n// they are created, and removed when they are handled.  Note that in ES6 or\n// shimmed environments, this would naturally be a `Set`.\nvar unhandledReasons = [];\nvar unhandledRejections = [];\nvar reportedUnhandledRejections = [];\nvar trackUnhandledRejections = true;\n\nfunction resetUnhandledRejections() {\n    unhandledReasons.length = 0;\n    unhandledRejections.length = 0;\n\n    if (!trackUnhandledRejections) {\n        trackUnhandledRejections = true;\n    }\n}\n\nfunction trackRejection(promise, reason) {\n    if (!trackUnhandledRejections) {\n        return;\n    }\n    if (typeof process === \"object\" && typeof process.emit === \"function\") {\n        Q.nextTick.runAfter(function () {\n            if (array_indexOf(unhandledRejections, promise) !== -1) {\n                process.emit(\"unhandledRejection\", reason, promise);\n                reportedUnhandledRejections.push(promise);\n            }\n        });\n    }\n\n    unhandledRejections.push(promise);\n    if (reason && typeof reason.stack !== \"undefined\") {\n        unhandledReasons.push(reason.stack);\n    } else {\n        unhandledReasons.push(\"(no stack) \" + reason);\n    }\n}\n\nfunction untrackRejection(promise) {\n    if (!trackUnhandledRejections) {\n        return;\n    }\n\n    var at = array_indexOf(unhandledRejections, promise);\n    if (at !== -1) {\n        if (typeof process === \"object\" && typeof process.emit === \"function\") {\n            Q.nextTick.runAfter(function () {\n                var atReport = array_indexOf(reportedUnhandledRejections, promise);\n                if (atReport !== -1) {\n                    process.emit(\"rejectionHandled\", unhandledReasons[at], promise);\n                    reportedUnhandledRejections.splice(atReport, 1);\n                }\n            });\n        }\n        unhandledRejections.splice(at, 1);\n        unhandledReasons.splice(at, 1);\n    }\n}\n\nQ.resetUnhandledRejections = resetUnhandledRejections;\n\nQ.getUnhandledReasons = function () {\n    // Make a copy so that consumers can't interfere with our internal state.\n    return unhandledReasons.slice();\n};\n\nQ.stopUnhandledRejectionTracking = function () {\n    resetUnhandledRejections();\n    trackUnhandledRejections = false;\n};\n\nresetUnhandledRejections();\n\n//// END UNHANDLED REJECTION TRACKING\n\n/**\n * Constructs a rejected promise.\n * @param reason value describing the failure\n */\nQ.reject = reject;\nfunction reject(reason) {\n    var rejection = Promise({\n        \"when\": function (rejected) {\n            // note that the error has been handled\n            if (rejected) {\n                untrackRejection(this);\n            }\n            return rejected ? rejected(reason) : this;\n        }\n    }, function fallback() {\n        return this;\n    }, function inspect() {\n        return { state: \"rejected\", reason: reason };\n    });\n\n    // Note that the reason has not been handled.\n    trackRejection(rejection, reason);\n\n    return rejection;\n}\n\n/**\n * Constructs a fulfilled promise for an immediate reference.\n * @param value immediate reference\n */\nQ.fulfill = fulfill;\nfunction fulfill(value) {\n    return Promise({\n        \"when\": function () {\n            return value;\n        },\n        \"get\": function (name) {\n            return value[name];\n        },\n        \"set\": function (name, rhs) {\n            value[name] = rhs;\n        },\n        \"delete\": function (name) {\n            delete value[name];\n        },\n        \"post\": function (name, args) {\n            // Mark Miller proposes that post with no name should apply a\n            // promised function.\n            if (name === null || name === void 0) {\n                return value.apply(void 0, args);\n            } else {\n                return value[name].apply(value, args);\n            }\n        },\n        \"apply\": function (thisp, args) {\n            return value.apply(thisp, args);\n        },\n        \"keys\": function () {\n            return object_keys(value);\n        }\n    }, void 0, function inspect() {\n        return { state: \"fulfilled\", value: value };\n    });\n}\n\n/**\n * Converts thenables to Q promises.\n * @param promise thenable promise\n * @returns a Q promise\n */\nfunction coerce(promise) {\n    var deferred = defer();\n    Q.nextTick(function () {\n        try {\n            promise.then(deferred.resolve, deferred.reject, deferred.notify);\n        } catch (exception) {\n            deferred.reject(exception);\n        }\n    });\n    return deferred.promise;\n}\n\n/**\n * Annotates an object such that it will never be\n * transferred away from this process over any promise\n * communication channel.\n * @param object\n * @returns promise a wrapping of that object that\n * additionally responds to the \"isDef\" message\n * without a rejection.\n */\nQ.master = master;\nfunction master(object) {\n    return Promise({\n        \"isDef\": function () {}\n    }, function fallback(op, args) {\n        return dispatch(object, op, args);\n    }, function () {\n        return Q(object).inspect();\n    });\n}\n\n/**\n * Spreads the values of a promised array of arguments into the\n * fulfillment callback.\n * @param fulfilled callback that receives variadic arguments from the\n * promised array\n * @param rejected callback that receives the exception if the promise\n * is rejected.\n * @returns a promise for the return value or thrown exception of\n * either callback.\n */\nQ.spread = spread;\nfunction spread(value, fulfilled, rejected) {\n    return Q(value).spread(fulfilled, rejected);\n}\n\nPromise.prototype.spread = function (fulfilled, rejected) {\n    return this.all().then(function (array) {\n        return fulfilled.apply(void 0, array);\n    }, rejected);\n};\n\n/**\n * The async function is a decorator for generator functions, turning\n * them into asynchronous generators.  Although generators are only part\n * of the newest ECMAScript 6 drafts, this code does not cause syntax\n * errors in older engines.  This code should continue to work and will\n * in fact improve over time as the language improves.\n *\n * ES6 generators are currently part of V8 version 3.19 with the\n * --harmony-generators runtime flag enabled.  SpiderMonkey has had them\n * for longer, but under an older Python-inspired form.  This function\n * works on both kinds of generators.\n *\n * Decorates a generator function such that:\n *  - it may yield promises\n *  - execution will continue when that promise is fulfilled\n *  - the value of the yield expression will be the fulfilled value\n *  - it returns a promise for the return value (when the generator\n *    stops iterating)\n *  - the decorated function returns a promise for the return value\n *    of the generator or the first rejected promise among those\n *    yielded.\n *  - if an error is thrown in the generator, it propagates through\n *    every following yield until it is caught, or until it escapes\n *    the generator function altogether, and is translated into a\n *    rejection for the promise returned by the decorated generator.\n */\nQ.async = async;\nfunction async(makeGenerator) {\n    return function () {\n        // when verb is \"send\", arg is a value\n        // when verb is \"throw\", arg is an exception\n        function continuer(verb, arg) {\n            var result;\n\n            // Until V8 3.19 / Chromium 29 is released, SpiderMonkey is the only\n            // engine that has a deployed base of browsers that support generators.\n            // However, SM's generators use the Python-inspired semantics of\n            // outdated ES6 drafts.  We would like to support ES6, but we'd also\n            // like to make it possible to use generators in deployed browsers, so\n            // we also support Python-style generators.  At some point we can remove\n            // this block.\n\n            if (typeof StopIteration === \"undefined\") {\n                // ES6 Generators\n                try {\n                    result = generator[verb](arg);\n                } catch (exception) {\n                    return reject(exception);\n                }\n                if (result.done) {\n                    return Q(result.value);\n                } else {\n                    return when(result.value, callback, errback);\n                }\n            } else {\n                // SpiderMonkey Generators\n                // FIXME: Remove this case when SM does ES6 generators.\n                try {\n                    result = generator[verb](arg);\n                } catch (exception) {\n                    if (isStopIteration(exception)) {\n                        return Q(exception.value);\n                    } else {\n                        return reject(exception);\n                    }\n                }\n                return when(result, callback, errback);\n            }\n        }\n        var generator = makeGenerator.apply(this, arguments);\n        var callback = continuer.bind(continuer, \"next\");\n        var errback = continuer.bind(continuer, \"throw\");\n        return callback();\n    };\n}\n\n/**\n * The spawn function is a small wrapper around async that immediately\n * calls the generator and also ends the promise chain, so that any\n * unhandled errors are thrown instead of forwarded to the error\n * handler. This is useful because it's extremely common to run\n * generators at the top-level to work with libraries.\n */\nQ.spawn = spawn;\nfunction spawn(makeGenerator) {\n    Q.done(Q.async(makeGenerator)());\n}\n\n// FIXME: Remove this interface once ES6 generators are in SpiderMonkey.\n/**\n * Throws a ReturnValue exception to stop an asynchronous generator.\n *\n * This interface is a stop-gap measure to support generator return\n * values in older Firefox/SpiderMonkey.  In browsers that support ES6\n * generators like Chromium 29, just use \"return\" in your generator\n * functions.\n *\n * @param value the return value for the surrounding generator\n * @throws ReturnValue exception with the value.\n * @example\n * // ES6 style\n * Q.async(function* () {\n *      var foo = yield getFooPromise();\n *      var bar = yield getBarPromise();\n *      return foo + bar;\n * })\n * // Older SpiderMonkey style\n * Q.async(function () {\n *      var foo = yield getFooPromise();\n *      var bar = yield getBarPromise();\n *      Q.return(foo + bar);\n * })\n */\nQ[\"return\"] = _return;\nfunction _return(value) {\n    throw new QReturnValue(value);\n}\n\n/**\n * The promised function decorator ensures that any promise arguments\n * are settled and passed as values (`this` is also settled and passed\n * as a value).  It will also ensure that the result of a function is\n * always a promise.\n *\n * @example\n * var add = Q.promised(function (a, b) {\n *     return a + b;\n * });\n * add(Q(a), Q(B));\n *\n * @param {function} callback The function to decorate\n * @returns {function} a function that has been decorated.\n */\nQ.promised = promised;\nfunction promised(callback) {\n    return function () {\n        return spread([this, all(arguments)], function (self, args) {\n            return callback.apply(self, args);\n        });\n    };\n}\n\n/**\n * sends a message to a value in a future turn\n * @param object* the recipient\n * @param op the name of the message operation, e.g., \"when\",\n * @param args further arguments to be forwarded to the operation\n * @returns result {Promise} a promise for the result of the operation\n */\nQ.dispatch = dispatch;\nfunction dispatch(object, op, args) {\n    return Q(object).dispatch(op, args);\n}\n\nPromise.prototype.dispatch = function (op, args) {\n    var self = this;\n    var deferred = defer();\n    Q.nextTick(function () {\n        self.promiseDispatch(deferred.resolve, op, args);\n    });\n    return deferred.promise;\n};\n\n/**\n * Gets the value of a property in a future turn.\n * @param object    promise or immediate reference for target object\n * @param name      name of property to get\n * @return promise for the property value\n */\nQ.get = function (object, key) {\n    return Q(object).dispatch(\"get\", [key]);\n};\n\nPromise.prototype.get = function (key) {\n    return this.dispatch(\"get\", [key]);\n};\n\n/**\n * Sets the value of a property in a future turn.\n * @param object    promise or immediate reference for object object\n * @param name      name of property to set\n * @param value     new value of property\n * @return promise for the return value\n */\nQ.set = function (object, key, value) {\n    return Q(object).dispatch(\"set\", [key, value]);\n};\n\nPromise.prototype.set = function (key, value) {\n    return this.dispatch(\"set\", [key, value]);\n};\n\n/**\n * Deletes a property in a future turn.\n * @param object    promise or immediate reference for target object\n * @param name      name of property to delete\n * @return promise for the return value\n */\nQ.del = // XXX legacy\nQ[\"delete\"] = function (object, key) {\n    return Q(object).dispatch(\"delete\", [key]);\n};\n\nPromise.prototype.del = // XXX legacy\nPromise.prototype[\"delete\"] = function (key) {\n    return this.dispatch(\"delete\", [key]);\n};\n\n/**\n * Invokes a method in a future turn.\n * @param object    promise or immediate reference for target object\n * @param name      name of method to invoke\n * @param value     a value to post, typically an array of\n *                  invocation arguments for promises that\n *                  are ultimately backed with `resolve` values,\n *                  as opposed to those backed with URLs\n *                  wherein the posted value can be any\n *                  JSON serializable object.\n * @return promise for the return value\n */\n// bound locally because it is used by other methods\nQ.mapply = // XXX As proposed by \"Redsandro\"\nQ.post = function (object, name, args) {\n    return Q(object).dispatch(\"post\", [name, args]);\n};\n\nPromise.prototype.mapply = // XXX As proposed by \"Redsandro\"\nPromise.prototype.post = function (name, args) {\n    return this.dispatch(\"post\", [name, args]);\n};\n\n/**\n * Invokes a method in a future turn.\n * @param object    promise or immediate reference for target object\n * @param name      name of method to invoke\n * @param ...args   array of invocation arguments\n * @return promise for the return value\n */\nQ.send = // XXX Mark Miller's proposed parlance\nQ.mcall = // XXX As proposed by \"Redsandro\"\nQ.invoke = function (object, name /*...args*/) {\n    return Q(object).dispatch(\"post\", [name, array_slice(arguments, 2)]);\n};\n\nPromise.prototype.send = // XXX Mark Miller's proposed parlance\nPromise.prototype.mcall = // XXX As proposed by \"Redsandro\"\nPromise.prototype.invoke = function (name /*...args*/) {\n    return this.dispatch(\"post\", [name, array_slice(arguments, 1)]);\n};\n\n/**\n * Applies the promised function in a future turn.\n * @param object    promise or immediate reference for target function\n * @param args      array of application arguments\n */\nQ.fapply = function (object, args) {\n    return Q(object).dispatch(\"apply\", [void 0, args]);\n};\n\nPromise.prototype.fapply = function (args) {\n    return this.dispatch(\"apply\", [void 0, args]);\n};\n\n/**\n * Calls the promised function in a future turn.\n * @param object    promise or immediate reference for target function\n * @param ...args   array of application arguments\n */\nQ[\"try\"] =\nQ.fcall = function (object /* ...args*/) {\n    return Q(object).dispatch(\"apply\", [void 0, array_slice(arguments, 1)]);\n};\n\nPromise.prototype.fcall = function (/*...args*/) {\n    return this.dispatch(\"apply\", [void 0, array_slice(arguments)]);\n};\n\n/**\n * Binds the promised function, transforming return values into a fulfilled\n * promise and thrown errors into a rejected one.\n * @param object    promise or immediate reference for target function\n * @param ...args   array of application arguments\n */\nQ.fbind = function (object /*...args*/) {\n    var promise = Q(object);\n    var args = array_slice(arguments, 1);\n    return function fbound() {\n        return promise.dispatch(\"apply\", [\n            this,\n            args.concat(array_slice(arguments))\n        ]);\n    };\n};\nPromise.prototype.fbind = function (/*...args*/) {\n    var promise = this;\n    var args = array_slice(arguments);\n    return function fbound() {\n        return promise.dispatch(\"apply\", [\n            this,\n            args.concat(array_slice(arguments))\n        ]);\n    };\n};\n\n/**\n * Requests the names of the owned properties of a promised\n * object in a future turn.\n * @param object    promise or immediate reference for target object\n * @return promise for the keys of the eventually settled object\n */\nQ.keys = function (object) {\n    return Q(object).dispatch(\"keys\", []);\n};\n\nPromise.prototype.keys = function () {\n    return this.dispatch(\"keys\", []);\n};\n\n/**\n * Turns an array of promises into a promise for an array.  If any of\n * the promises gets rejected, the whole array is rejected immediately.\n * @param {Array*} an array (or promise for an array) of values (or\n * promises for values)\n * @returns a promise for an array of the corresponding values\n */\n// By Mark Miller\n// http://wiki.ecmascript.org/doku.php?id=strawman:concurrency&rev=1308776521#allfulfilled\nQ.all = all;\nfunction all(promises) {\n    return when(promises, function (promises) {\n        var pendingCount = 0;\n        var deferred = defer();\n        array_reduce(promises, function (undefined, promise, index) {\n            var snapshot;\n            if (\n                isPromise(promise) &&\n                (snapshot = promise.inspect()).state === \"fulfilled\"\n            ) {\n                promises[index] = snapshot.value;\n            } else {\n                ++pendingCount;\n                when(\n                    promise,\n                    function (value) {\n                        promises[index] = value;\n                        if (--pendingCount === 0) {\n                            deferred.resolve(promises);\n                        }\n                    },\n                    deferred.reject,\n                    function (progress) {\n                        deferred.notify({ index: index, value: progress });\n                    }\n                );\n            }\n        }, void 0);\n        if (pendingCount === 0) {\n            deferred.resolve(promises);\n        }\n        return deferred.promise;\n    });\n}\n\nPromise.prototype.all = function () {\n    return all(this);\n};\n\n/**\n * Returns the first resolved promise of an array. Prior rejected promises are\n * ignored.  Rejects only if all promises are rejected.\n * @param {Array*} an array containing values or promises for values\n * @returns a promise fulfilled with the value of the first resolved promise,\n * or a rejected promise if all promises are rejected.\n */\nQ.any = any;\n\nfunction any(promises) {\n    if (promises.length === 0) {\n        return Q.resolve();\n    }\n\n    var deferred = Q.defer();\n    var pendingCount = 0;\n    array_reduce(promises, function (prev, current, index) {\n        var promise = promises[index];\n\n        pendingCount++;\n\n        when(promise, onFulfilled, onRejected, onProgress);\n        function onFulfilled(result) {\n            deferred.resolve(result);\n        }\n        function onRejected(err) {\n            pendingCount--;\n            if (pendingCount === 0) {\n                err.message = (\"Q can't get fulfillment value from any promise, all \" +\n                    \"promises were rejected. Last error message: \" + err.message);\n                deferred.reject(err);\n            }\n        }\n        function onProgress(progress) {\n            deferred.notify({\n                index: index,\n                value: progress\n            });\n        }\n    }, undefined);\n\n    return deferred.promise;\n}\n\nPromise.prototype.any = function () {\n    return any(this);\n};\n\n/**\n * Waits for all promises to be settled, either fulfilled or\n * rejected.  This is distinct from `all` since that would stop\n * waiting at the first rejection.  The promise returned by\n * `allResolved` will never be rejected.\n * @param promises a promise for an array (or an array) of promises\n * (or values)\n * @return a promise for an array of promises\n */\nQ.allResolved = deprecate(allResolved, \"allResolved\", \"allSettled\");\nfunction allResolved(promises) {\n    return when(promises, function (promises) {\n        promises = array_map(promises, Q);\n        return when(all(array_map(promises, function (promise) {\n            return when(promise, noop, noop);\n        })), function () {\n            return promises;\n        });\n    });\n}\n\nPromise.prototype.allResolved = function () {\n    return allResolved(this);\n};\n\n/**\n * @see Promise#allSettled\n */\nQ.allSettled = allSettled;\nfunction allSettled(promises) {\n    return Q(promises).allSettled();\n}\n\n/**\n * Turns an array of promises into a promise for an array of their states (as\n * returned by `inspect`) when they have all settled.\n * @param {Array[Any*]} values an array (or promise for an array) of values (or\n * promises for values)\n * @returns {Array[State]} an array of states for the respective values.\n */\nPromise.prototype.allSettled = function () {\n    return this.then(function (promises) {\n        return all(array_map(promises, function (promise) {\n            promise = Q(promise);\n            function regardless() {\n                return promise.inspect();\n            }\n            return promise.then(regardless, regardless);\n        }));\n    });\n};\n\n/**\n * Captures the failure of a promise, giving an oportunity to recover\n * with a callback.  If the given promise is fulfilled, the returned\n * promise is fulfilled.\n * @param {Any*} promise for something\n * @param {Function} callback to fulfill the returned promise if the\n * given promise is rejected\n * @returns a promise for the return value of the callback\n */\nQ.fail = // XXX legacy\nQ[\"catch\"] = function (object, rejected) {\n    return Q(object).then(void 0, rejected);\n};\n\nPromise.prototype.fail = // XXX legacy\nPromise.prototype[\"catch\"] = function (rejected) {\n    return this.then(void 0, rejected);\n};\n\n/**\n * Attaches a listener that can respond to progress notifications from a\n * promise's originating deferred. This listener receives the exact arguments\n * passed to ``deferred.notify``.\n * @param {Any*} promise for something\n * @param {Function} callback to receive any progress notifications\n * @returns the given promise, unchanged\n */\nQ.progress = progress;\nfunction progress(object, progressed) {\n    return Q(object).then(void 0, void 0, progressed);\n}\n\nPromise.prototype.progress = function (progressed) {\n    return this.then(void 0, void 0, progressed);\n};\n\n/**\n * Provides an opportunity to observe the settling of a promise,\n * regardless of whether the promise is fulfilled or rejected.  Forwards\n * the resolution to the returned promise when the callback is done.\n * The callback can return a promise to defer completion.\n * @param {Any*} promise\n * @param {Function} callback to observe the resolution of the given\n * promise, takes no arguments.\n * @returns a promise for the resolution of the given promise when\n * ``fin`` is done.\n */\nQ.fin = // XXX legacy\nQ[\"finally\"] = function (object, callback) {\n    return Q(object)[\"finally\"](callback);\n};\n\nPromise.prototype.fin = // XXX legacy\nPromise.prototype[\"finally\"] = function (callback) {\n    if (!callback || typeof callback.apply !== \"function\") {\n        throw new Error(\"Q can't apply finally callback\");\n    }\n    callback = Q(callback);\n    return this.then(function (value) {\n        return callback.fcall().then(function () {\n            return value;\n        });\n    }, function (reason) {\n        // TODO attempt to recycle the rejection with \"this\".\n        return callback.fcall().then(function () {\n            throw reason;\n        });\n    });\n};\n\n/**\n * Terminates a chain of promises, forcing rejections to be\n * thrown as exceptions.\n * @param {Any*} promise at the end of a chain of promises\n * @returns nothing\n */\nQ.done = function (object, fulfilled, rejected, progress) {\n    return Q(object).done(fulfilled, rejected, progress);\n};\n\nPromise.prototype.done = function (fulfilled, rejected, progress) {\n    var onUnhandledError = function (error) {\n        // forward to a future turn so that ``when``\n        // does not catch it and turn it into a rejection.\n        Q.nextTick(function () {\n            makeStackTraceLong(error, promise);\n            if (Q.onerror) {\n                Q.onerror(error);\n            } else {\n                throw error;\n            }\n        });\n    };\n\n    // Avoid unnecessary `nextTick`ing via an unnecessary `when`.\n    var promise = fulfilled || rejected || progress ?\n        this.then(fulfilled, rejected, progress) :\n        this;\n\n    if (typeof process === \"object\" && process && process.domain) {\n        onUnhandledError = process.domain.bind(onUnhandledError);\n    }\n\n    promise.then(void 0, onUnhandledError);\n};\n\n/**\n * Causes a promise to be rejected if it does not get fulfilled before\n * some milliseconds time out.\n * @param {Any*} promise\n * @param {Number} milliseconds timeout\n * @param {Any*} custom error message or Error object (optional)\n * @returns a promise for the resolution of the given promise if it is\n * fulfilled before the timeout, otherwise rejected.\n */\nQ.timeout = function (object, ms, error) {\n    return Q(object).timeout(ms, error);\n};\n\nPromise.prototype.timeout = function (ms, error) {\n    var deferred = defer();\n    var timeoutId = setTimeout(function () {\n        if (!error || \"string\" === typeof error) {\n            error = new Error(error || \"Timed out after \" + ms + \" ms\");\n            error.code = \"ETIMEDOUT\";\n        }\n        deferred.reject(error);\n    }, ms);\n\n    this.then(function (value) {\n        clearTimeout(timeoutId);\n        deferred.resolve(value);\n    }, function (exception) {\n        clearTimeout(timeoutId);\n        deferred.reject(exception);\n    }, deferred.notify);\n\n    return deferred.promise;\n};\n\n/**\n * Returns a promise for the given value (or promised value), some\n * milliseconds after it resolved. Passes rejections immediately.\n * @param {Any*} promise\n * @param {Number} milliseconds\n * @returns a promise for the resolution of the given promise after milliseconds\n * time has elapsed since the resolution of the given promise.\n * If the given promise rejects, that is passed immediately.\n */\nQ.delay = function (object, timeout) {\n    if (timeout === void 0) {\n        timeout = object;\n        object = void 0;\n    }\n    return Q(object).delay(timeout);\n};\n\nPromise.prototype.delay = function (timeout) {\n    return this.then(function (value) {\n        var deferred = defer();\n        setTimeout(function () {\n            deferred.resolve(value);\n        }, timeout);\n        return deferred.promise;\n    });\n};\n\n/**\n * Passes a continuation to a Node function, which is called with the given\n * arguments provided as an array, and returns a promise.\n *\n *      Q.nfapply(FS.readFile, [__filename])\n *      .then(function (content) {\n *      })\n *\n */\nQ.nfapply = function (callback, args) {\n    return Q(callback).nfapply(args);\n};\n\nPromise.prototype.nfapply = function (args) {\n    var deferred = defer();\n    var nodeArgs = array_slice(args);\n    nodeArgs.push(deferred.makeNodeResolver());\n    this.fapply(nodeArgs).fail(deferred.reject);\n    return deferred.promise;\n};\n\n/**\n * Passes a continuation to a Node function, which is called with the given\n * arguments provided individually, and returns a promise.\n * @example\n * Q.nfcall(FS.readFile, __filename)\n * .then(function (content) {\n * })\n *\n */\nQ.nfcall = function (callback /*...args*/) {\n    var args = array_slice(arguments, 1);\n    return Q(callback).nfapply(args);\n};\n\nPromise.prototype.nfcall = function (/*...args*/) {\n    var nodeArgs = array_slice(arguments);\n    var deferred = defer();\n    nodeArgs.push(deferred.makeNodeResolver());\n    this.fapply(nodeArgs).fail(deferred.reject);\n    return deferred.promise;\n};\n\n/**\n * Wraps a NodeJS continuation passing function and returns an equivalent\n * version that returns a promise.\n * @example\n * Q.nfbind(FS.readFile, __filename)(\"utf-8\")\n * .then(console.log)\n * .done()\n */\nQ.nfbind =\nQ.denodeify = function (callback /*...args*/) {\n    if (callback === undefined) {\n        throw new Error(\"Q can't wrap an undefined function\");\n    }\n    var baseArgs = array_slice(arguments, 1);\n    return function () {\n        var nodeArgs = baseArgs.concat(array_slice(arguments));\n        var deferred = defer();\n        nodeArgs.push(deferred.makeNodeResolver());\n        Q(callback).fapply(nodeArgs).fail(deferred.reject);\n        return deferred.promise;\n    };\n};\n\nPromise.prototype.nfbind =\nPromise.prototype.denodeify = function (/*...args*/) {\n    var args = array_slice(arguments);\n    args.unshift(this);\n    return Q.denodeify.apply(void 0, args);\n};\n\nQ.nbind = function (callback, thisp /*...args*/) {\n    var baseArgs = array_slice(arguments, 2);\n    return function () {\n        var nodeArgs = baseArgs.concat(array_slice(arguments));\n        var deferred = defer();\n        nodeArgs.push(deferred.makeNodeResolver());\n        function bound() {\n            return callback.apply(thisp, arguments);\n        }\n        Q(bound).fapply(nodeArgs).fail(deferred.reject);\n        return deferred.promise;\n    };\n};\n\nPromise.prototype.nbind = function (/*thisp, ...args*/) {\n    var args = array_slice(arguments, 0);\n    args.unshift(this);\n    return Q.nbind.apply(void 0, args);\n};\n\n/**\n * Calls a method of a Node-style object that accepts a Node-style\n * callback with a given array of arguments, plus a provided callback.\n * @param object an object that has the named method\n * @param {String} name name of the method of object\n * @param {Array} args arguments to pass to the method; the callback\n * will be provided by Q and appended to these arguments.\n * @returns a promise for the value or error\n */\nQ.nmapply = // XXX As proposed by \"Redsandro\"\nQ.npost = function (object, name, args) {\n    return Q(object).npost(name, args);\n};\n\nPromise.prototype.nmapply = // XXX As proposed by \"Redsandro\"\nPromise.prototype.npost = function (name, args) {\n    var nodeArgs = array_slice(args || []);\n    var deferred = defer();\n    nodeArgs.push(deferred.makeNodeResolver());\n    this.dispatch(\"post\", [name, nodeArgs]).fail(deferred.reject);\n    return deferred.promise;\n};\n\n/**\n * Calls a method of a Node-style object that accepts a Node-style\n * callback, forwarding the given variadic arguments, plus a provided\n * callback argument.\n * @param object an object that has the named method\n * @param {String} name name of the method of object\n * @param ...args arguments to pass to the method; the callback will\n * be provided by Q and appended to these arguments.\n * @returns a promise for the value or error\n */\nQ.nsend = // XXX Based on Mark Miller's proposed \"send\"\nQ.nmcall = // XXX Based on \"Redsandro's\" proposal\nQ.ninvoke = function (object, name /*...args*/) {\n    var nodeArgs = array_slice(arguments, 2);\n    var deferred = defer();\n    nodeArgs.push(deferred.makeNodeResolver());\n    Q(object).dispatch(\"post\", [name, nodeArgs]).fail(deferred.reject);\n    return deferred.promise;\n};\n\nPromise.prototype.nsend = // XXX Based on Mark Miller's proposed \"send\"\nPromise.prototype.nmcall = // XXX Based on \"Redsandro's\" proposal\nPromise.prototype.ninvoke = function (name /*...args*/) {\n    var nodeArgs = array_slice(arguments, 1);\n    var deferred = defer();\n    nodeArgs.push(deferred.makeNodeResolver());\n    this.dispatch(\"post\", [name, nodeArgs]).fail(deferred.reject);\n    return deferred.promise;\n};\n\n/**\n * If a function would like to support both Node continuation-passing-style and\n * promise-returning-style, it can end its internal promise chain with\n * `nodeify(nodeback)`, forwarding the optional nodeback argument.  If the user\n * elects to use a nodeback, the result will be sent there.  If they do not\n * pass a nodeback, they will receive the result promise.\n * @param object a result (or a promise for a result)\n * @param {Function} nodeback a Node.js-style callback\n * @returns either the promise or nothing\n */\nQ.nodeify = nodeify;\nfunction nodeify(object, nodeback) {\n    return Q(object).nodeify(nodeback);\n}\n\nPromise.prototype.nodeify = function (nodeback) {\n    if (nodeback) {\n        this.then(function (value) {\n            Q.nextTick(function () {\n                nodeback(null, value);\n            });\n        }, function (error) {\n            Q.nextTick(function () {\n                nodeback(error);\n            });\n        });\n    } else {\n        return this;\n    }\n};\n\nQ.noConflict = function() {\n    throw new Error(\"Q.noConflict only works when Q is used as a global\");\n};\n\n// All code before this point will be filtered from stack traces.\nvar qEndingLine = captureLine();\n\nreturn Q;\n\n});\n\n}).call(this,require('_process'))\n},{\"_process\":20}],22:[function(require,module,exports){\nvar _global = (function() { return this; })();\nvar NativeWebSocket = _global.WebSocket || _global.MozWebSocket;\nvar websocket_version = require('./version');\n\n\n/**\n * Expose a W3C WebSocket class with just one or two arguments.\n */\nfunction W3CWebSocket(uri, protocols) {\n\tvar native_instance;\n\n\tif (protocols) {\n\t\tnative_instance = new NativeWebSocket(uri, protocols);\n\t}\n\telse {\n\t\tnative_instance = new NativeWebSocket(uri);\n\t}\n\n\t/**\n\t * 'native_instance' is an instance of nativeWebSocket (the browser's WebSocket\n\t * class). Since it is an Object it will be returned as it is when creating an\n\t * instance of W3CWebSocket via 'new W3CWebSocket()'.\n\t *\n\t * ECMAScript 5: http://bclary.com/2004/11/07/#a-13.2.2\n\t */\n\treturn native_instance;\n}\n\n\n/**\n * Module exports.\n */\nmodule.exports = {\n    'w3cwebsocket' : NativeWebSocket ? W3CWebSocket : null,\n    'version'      : websocket_version\n};\n\n},{\"./version\":23}],23:[function(require,module,exports){\nmodule.exports = require('../package.json').version;\n\n},{\"../package.json\":24}],24:[function(require,module,exports){\nmodule.exports={\n  \"_args\": [\n    [\n      \"websocket@1.0.24\",\n      \"/opt/ashamed\"\n    ]\n  ],\n  \"_from\": \"websocket@1.0.24\",\n  \"_id\": \"websocket@1.0.24\",\n  \"_inBundle\": false,\n  \"_integrity\": \"sha1-dJA+dfJUW2suHeFCW8HJBZF6GJA=\",\n  \"_location\": \"/websocket\",\n  \"_phantomChildren\": {},\n  \"_requested\": {\n    \"type\": \"version\",\n    \"registry\": true,\n    \"raw\": \"websocket@1.0.24\",\n    \"name\": \"websocket\",\n    \"escapedName\": \"websocket\",\n    \"rawSpec\": \"1.0.24\",\n    \"saveSpec\": null,\n    \"fetchSpec\": \"1.0.24\"\n  },\n  \"_requiredBy\": [\n    \"/\"\n  ],\n  \"_resolved\": \"https://registry.npmjs.org/websocket/-/websocket-1.0.24.tgz\",\n  \"_spec\": \"1.0.24\",\n  \"_where\": \"/opt/ashamed\",\n  \"author\": {\n    \"name\": \"Brian McKelvey\",\n    \"email\": \"brian@worlize.com\",\n    \"url\": \"https://www.worlize.com/\"\n  },\n  \"browser\": \"lib/browser.js\",\n  \"bugs\": {\n    \"url\": \"https://github.com/theturtle32/WebSocket-Node/issues\"\n  },\n  \"config\": {\n    \"verbose\": false\n  },\n  \"contributors\": [\n    {\n      \"name\": \"Iaki Baz Castillo\",\n      \"email\": \"ibc@aliax.net\",\n      \"url\": \"http://dev.sipdoc.net\"\n    }\n  ],\n  \"dependencies\": {\n    \"debug\": \"^2.2.0\",\n    \"nan\": \"^2.3.3\",\n    \"typedarray-to-buffer\": \"^3.1.2\",\n    \"yaeti\": \"^0.0.6\"\n  },\n  \"description\": \"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.\",\n  \"devDependencies\": {\n    \"buffer-equal\": \"^1.0.0\",\n    \"faucet\": \"^0.0.1\",\n    \"gulp\": \"git+https://github.com/gulpjs/gulp.git#4.0\",\n    \"gulp-jshint\": \"^2.0.4\",\n    \"jshint\": \"^2.0.0\",\n    \"jshint-stylish\": \"^2.2.1\",\n    \"tape\": \"^4.0.1\"\n  },\n  \"directories\": {\n    \"lib\": \"./lib\"\n  },\n  \"engines\": {\n    \"node\": \">=0.8.0\"\n  },\n  \"homepage\": \"https://github.com/theturtle32/WebSocket-Node\",\n  \"keywords\": [\n    \"websocket\",\n    \"websockets\",\n    \"socket\",\n    \"networking\",\n    \"comet\",\n    \"push\",\n    \"RFC-6455\",\n    \"realtime\",\n    \"server\",\n    \"client\"\n  ],\n  \"license\": \"Apache-2.0\",\n  \"main\": \"index\",\n  \"name\": \"websocket\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/theturtle32/WebSocket-Node.git\"\n  },\n  \"scripts\": {\n    \"gulp\": \"gulp\",\n    \"install\": \"(node-gyp rebuild 2> builderror.log) || (exit 0)\",\n    \"test\": \"faucet test/unit\"\n  },\n  \"version\": \"1.0.24\"\n}\n\n},{}]},{},[1]);\n"]}